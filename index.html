<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>„Çâ„ÅÑ„ÇÄ„ÅÆÊ≠å„Åà„ÇãÊõ≤„É™„Çπ„Éà</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
        --bg: #020617;
        --bg-card: rgba(15, 23, 42, 0.85);
        --accent: #4b7fff;
        --accent-soft: rgba(75, 127, 255, 0.23);
        --accent-pink: #ff6ac1;
        --text-main: #e5e7eb;
        --text-sub: #9ca3af;
        --border: rgba(148, 163, 184, 0.4);
        --radius-lg: 18px;
        --shadow-soft: 0 14px 40px rgba(0, 0, 0, 0.7);
        }

        /* Ë°å„ÇíËß¶„Çå„Çã„Å®ÂÖâ„Çã */
        tbody tr {
        transition: background 0.12s ease, box-shadow 0.12s ease;
        }

        tbody tr:hover {
        background: rgba(56, 189, 248, 0.13);
        box-shadow: 0 0 12px rgba(56, 189, 248, 0.4);
        }


        /* ===== „Éô„Éº„Çπ ===== */
        * {
        box-sizing: border-box;
        }

        body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
            sans-serif;
        color: var(--text-main);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
        background: #000; /* Ë™≠„ÅøËæº„ÅøÂâç„ÅÆËâ≤ */
        }

        /* „Åº„ÇÑ„Åë„ÅüËÉåÊôØÂÜôÁúü */
        body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: url("./bg.jpg") center center / cover no-repeat;
        filter: blur(12px) brightness(0.55);
        transform: scale(1.06);
        z-index: -2;
        }

        /* ‰∏ä„Åã„Çâ„Éç„Ç™„É≥„Å£„ÅΩ„ÅÑ„Ç∞„É©„Éá */
        body::after {
        content: "";
        position: fixed;
        inset: 0;
        background:
            radial-gradient(circle at top left, rgba(79, 70, 229, 0.65), transparent 55%),
            radial-gradient(circle at bottom right, rgba(236, 72, 153, 0.5), transparent 55%),
            linear-gradient(to bottom, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.97));
        mix-blend-mode: screen;
        z-index: -1;
        }

        .container {
        max-width: 980px;
        margin: 0 auto;
        padding: 14px 16px 32px;
        }

        /* ===== „Éò„ÉÉ„ÉÄ„Éº ===== */
        header {
        position: sticky;
        top: 0;
        z-index: 20;
        padding: 10px 0 8px;
        }

        .header-inner {
        background: radial-gradient(
            circle at top,
            rgba(15, 23, 42, 0.98),
            rgba(15, 23, 42, 0.92)
            );
        border-radius: 20px;
        padding: 12px 16px 14px;
        box-shadow: var(--shadow-soft);
        border: 1px solid rgba(56, 189, 248, 0.25);
        }

        /* „Çø„Ç§„Éà„É´ */
        .title-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
        flex-wrap: wrap;
        justify-content: center;
        }

        h1 {
        margin: 0;
        font-size: 1.9rem;
        font-weight: 900;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: #e5edff;
        text-shadow:
            0 0 6px rgba(75, 127, 255, 0.9),
            0 0 18px rgba(56, 189, 248, 0.8),
            0 0 36px rgba(59, 130, 246, 0.7);
        display: flex;
        align-items: center;
        gap: 0.35em;
        }

        h1 span {
        font-size: 1.4rem;
        filter: drop-shadow(0 0 8px rgba(251, 113, 133, 0.8));
        }

        .title-chip {
        font-size: 0.72rem;
        padding: 3px 10px;
        border-radius: 999px;
        background: radial-gradient(circle at top left, #f97316, #7c3aed);
        color: #0b1020;
        border: 1px solid rgba(248, 250, 252, 0.8);
        text-transform: uppercase;
        letter-spacing: 0.14em;
        box-shadow:
            0 0 10px rgba(249, 115, 22, 0.8),
            0 0 26px rgba(124, 58, 237, 0.8);
        }

        .tagline {
        font-size: 0.9rem;
        color: var(--text-sub);
        text-align: center;
        }

        .note {
        font-size: 0.75rem;
        color: #6b7280;
        text-align: center;
        margin-top: 2px;
        }

        /* ===== Ê§úÁ¥¢ & „Éï„Ç£„É´„Çø ===== */
        .controls {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        gap: 8px;

        /* Êäò„Çä„Åü„Åü„ÅøÁî® */
        max-height: 500px;        /* ‰∏≠Ë∫´„Çà„Çä„Å°„Çá„Å£„Å®Â§ß„Åç„ÇÅ„Å™„ÇâOK */
        opacity: 1;
        overflow: hidden;
        transition:
            max-height 0.28s ease,
            opacity 0.2s ease,
            margin-top 0.2s ease;
        }
        
        /* Èñâ„Åò„Åü„Å®„Åç„ÅÆÁä∂ÊÖã */
        .controls.collapsed {
        max-height: 0;
        opacity: 0;
        margin-top: 0;
        pointer-events: none;
        }

        /* „Éà„Ç∞„É´„Éú„Çø„É≥Ë°å */
        .controls-toggle-row {
        margin-top: 8px;
        display: flex;
        justify-content: flex-end;
        }

        /* „Éà„Ç∞„É´„Éú„Çø„É≥Êú¨‰Ωì */
        .controls-toggle {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: radial-gradient(circle at top left,#020617,#020617);
        color: #e5e7eb;
        font-size: 0.72rem;
        padding: 4px 10px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        box-shadow: 0 0 0 1px rgba(15,23,42,0.8);
        }

        .controls-toggle:hover {
        border-color: #4b7fff;
        box-shadow:
            0 0 0 1px rgba(15,23,42,1),
            0 0 12px rgba(59,130,246,0.7);
        }

        .controls-toggle-icon {
        font-size: 0.8rem;
        }   

        .search-box label {
        font-size: 0.78rem;
        color: #9ca3af;
        display: block;
        margin-bottom: 4px;
        }

        .search-input-wrap {
        position: relative;
        }

        .search-box input {
        width: 100%;
        padding: 9px 12px 9px 32px;
        font-size: 0.95rem;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        outline: none;
        background: radial-gradient(circle at top left, #020617, #020617);
        color: var(--text-main);
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.8);
        }

        .search-box input::placeholder {
        color: #6b7280;
        }

        .search-box input:focus {
        border-color: var(--accent);
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 1),
            0 0 18px rgba(59, 130, 246, 0.8);
        }

        .search-icon {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.9rem;
        color: #6b7280;
        pointer-events: none;
        }

        .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 4px;
        justify-content: center;
        }

        /* „Éï„Ç£„É´„Çø„Éú„Çø„É≥Ôºà„Ç´„ÉÜ„Ç¥„É™Ôºâ */
        .filter-btn {
        border: 1px solid rgba(148, 163, 184, 0.7);
        border-radius: 999px;
        padding: 4px 9px;
        font-size: 0.75rem;
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-sub);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
        transition:
            background 0.12s,
            color 0.12s,
            border-color 0.12s,
            transform 0.06s,
            box-shadow 0.12s;
        }

        .filter-btn span.count {
        font-size: 0.68rem;
        padding: 1px 6px;
        border-radius: 999px;
        background: rgba(31, 41, 55, 0.9);
        color: #e5e7eb;
        }

        .filter-btn.active {
        background: radial-gradient(circle at top, #4f46e5, #0ea5e9);
        color: #f9fafb;
        border-color: rgba(56, 189, 248, 0.9);
        box-shadow:
            0 0 10px rgba(56, 189, 248, 0.85),
            0 0 22px rgba(79, 70, 229, 0.85);
        }

        .filter-btn.active span.count {
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        }

        .filter-btn:active {
        transform: translateY(1px) scale(0.98);
        }

        /* ===== „É°„Ç§„É≥ & „ÉÜ„Éº„Éñ„É´ ===== */
        main {
        margin-top: 14px;
        }

        .category-section {
        margin-top: 18px;
        }

        .category-header {
        display: flex;
        align-items: baseline;
        gap: 6px;
        margin-bottom: 6px;
        }

        .category-title {
        font-size: 1.05rem;
        margin: 0;
        padding-left: 10px;
        border-left: 3px solid var(--accent);
        color: #e5edff;
        text-shadow: 0 0 10px rgba(56, 189, 248, 0.7);
        }

        .category-badge {
        font-size: 0.7rem;
        color: var(--text-sub);
        }

        /* „Ç¨„É©„Çπ„Ç´„Éº„ÉâÈ¢®„ÉÜ„Éº„Éñ„É´ */
        .table-wrapper {
        background: linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.95),
            rgba(15, 23, 42, 0.86)
        );
        border-radius: var(--radius-lg);
        padding: 6px 6px 4px;
        box-shadow: var(--shadow-soft);
        border: 1px solid rgba(37, 99, 235, 0.7);
        overflow-x: auto;
        }

        /* Êõ≤„Çø„Ç§„Éà„É´ */
        .song-title {
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            letter-spacing: 0.5px;
            text-shadow: 0 0 6px rgba(255, 255, 255, 0.4);
        }

        /* „Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÂêçÔºàÂ∞ë„ÅóËñÑ„ÅèÔºâ */
        .song-artist {
            font-size: 14px;
            opacity: 0.75;
            color: #eee;
            margin-top: 3px;
        }

        /* „É°„É¢„Éê„ÉÉ„Ç∏ÔºàÈõ£ÊòìÂ∫¶„Å®„ÅãÔºâ */
        .song-memo {
            background: linear-gradient(135deg, #6d9dff, #b388ff);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            color: #fff;
            margin-left: 14px;
            box-shadow: 0 0 12px rgba(100, 149, 255, 0.6);
        }

        table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
        min-width: 320px;
        }

        th,
        td {
        padding: 6px 8px;
        text-align: left;
        vertical-align: top;
        border-bottom: 1px solid rgba(31, 41, 55, 0.9);
        }

        th {
        font-size: 0.78rem;
        background: radial-gradient(
            circle at top left,
            rgba(15, 23, 42, 0.9),
            rgba(15, 23, 42, 0.98)
        );
        color: #9ca3af;
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 5;
        }

        tr:last-child td {
        border-bottom: none;
        }

        /* Êõ≤Âêç„Éª„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà„Éª„É°„É¢ */
        .song-title {
        font-weight: 600;
        letter-spacing: 0.02em;
        }

        .song-artist {
        color: #a5b4fc;
        font-size: 0.85rem;
        }

        .memo-pill {
        display: inline-flex;
        align-items: center;
        padding: 1px 6px;
        border-radius: 999px;
        font-size: 0.72rem;
        border: 1px solid rgba(148, 163, 184, 0.8);
        color: #e5e7eb;
        background: rgba(15, 23, 42, 0.9);
        margin-right: 3px;
        }

        .memo-pill.memo-ng {
        border-color: #f97373;
        background: rgba(127, 29, 29, 0.9);
        color: #fee2e2;
        box-shadow: 0 0 10px rgba(248, 113, 113, 0.7);
        }

        .memo-pill.memo-training {
        border-color: #38bdf8;
        background: rgba(8, 47, 73, 0.96);
        color: #e0f2fe;
        box-shadow: 0 0 10px rgba(56, 189, 248, 0.7);
        }

        .memo-pill.memo-key {
        border-color: #a855f7;
        background: rgba(46, 16, 101, 0.95);
        color: #f5e9ff;
        box-shadow: 0 0 10px rgba(168, 85, 247, 0.7);
        }

        .memo-text {
        font-size: 0.8rem;
        color: #cbd5f5;
        margin-top: 1px;
        }
        /* ===== Êõ≤Ë°åÔºà1Êõ≤ÂàÜÔºâ„Éª„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ ===== */
        .song-row {
        opacity: 0;
        transform: translateY(18px) scale(0.96);
        animation: songRowIn 0.55s cubic-bezier(0.16, 0.84, 0.44, 1) forwards;
        animation-delay: calc(var(--row-index, 0) * 0.04s);

        transition:
            transform 0.18s ease,
            box-shadow 0.18s ease,
            background 0.18s ease,
            border-color 0.18s ease;
        }

        .song-row:hover {
        background: rgba(56, 189, 248, 0.13);
        box-shadow: 0 0 12px rgba(56, 189, 248, 0.4);
        }

        /* „Éï„Çß„Éº„Éâ„Ç§„É≥ & ‰∏ã„Åã„Çâ„Çπ„ÉÉ„Å®Âá∫„Çã„Ç¢„Éã„É° */
        @keyframes songRowIn {
        0% {
            opacity: 0;
            transform: translateY(22px) scale(0.94);
        }
        55% {
            opacity: 1;
            transform: translateY(-3px) scale(1.02);
        }
        100% {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        }
        
        /* Ë°å„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπËâ≤‰ªò„Åë */
        tr.row-ng {
        background: rgba(127, 29, 29, 0.32);
        }

        tr.row-training {
        background: rgba(8, 47, 73, 0.32);
        }

        /* „Éõ„Éê„ÉºÊôÇ„ÇÇ„Å°„ÇÉ„Çì„Å®‰∏äÊõ∏„Åç„Åó„Åü„ÅÑÂ†¥ÂêàÔºà‰ªªÊÑèÔºâ */
        tr.row-ng:hover {
        background: rgba(185, 28, 28, 0.45);
        }

        tr.row-training:hover {
        background: rgba(3, 105, 161, 0.45);
        }

        .song-title {
        font-size: 1.05rem;
        font-weight: 600;
        }

        .song-artist {
        font-size: 0.85rem;
        color: #a5b4fc;
        }

        .empty-msg {
        margin-top: 24px;
        text-align: center;
        font-size: 0.85rem;
        color: var(--text-sub);
        }

        /* ===== „Éï„ÉÉ„Çø„Éº ===== */
        footer {
        margin-top: 26px;
        text-align: center;
        font-size: 0.7rem;
        color: #6b7280;
        }

        /* ===== „Çπ„Éû„ÉõÂØæÂøú ===== */
        @media (max-width: 600px) {
        h1 {
            font-size: 1.5rem;
            letter-spacing: 0.12em;
        }

        .header-inner {
            padding: 10px 10px 12px;
        }

        table {
            font-size: 0.84rem;
        }

        th,
        td {
            padding: 6px 6px;
        }

        .container {
            padding-inline: 10px;
        }
        }

        </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-inner">
        <div class="title-row">
          <h1>„Çâ„ÅÑ„ÇÄ„ÅÆÊ≠å„Åà„ÇãÊõ≤„É™„Çπ„Éà <span>üé§</span></h1>
          <span class="title-chip">„É™„ÇØ„Ç®„Çπ„ÉàÊ≠ìËøé</span>
        </div>
        <div class="tagline">
          ÈÖç‰ø°„ÅßÊ≠å„Åà„ÇãÔºàÊ≠å„ÅÑ„Åü„ÅÑÔºâÊõ≤„Çí„Åæ„Å®„ÇÅ„Åü„Éö„Éº„Ç∏„Åß„Åô„ÄÇ
        </div>
        <div class="note">Êõ≤Âêç„Éª„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà„Éª„É°„É¢„ÅßÊ§úÁ¥¢„Åß„Åç„Åæ„Åô</div>
        <!-- ‚òÖ ËøΩÂä†ÔºöÈñãÈñâ„Éú„Çø„É≥ -->
        <div class="controls-toggle-row">
        <button type="button" class="controls-toggle" id="controlsToggle">
            <span class="controls-toggle-icon" id="controlsToggleIcon">‚ñ≤</span>
            <span id="controlsToggleLabel">Ê§úÁ¥¢„ÉªÁµû„ÇäËæº„Åø„ÇíÈñâ„Åò„Çã</span>
        </button>
        </div>

        <div class="controls" id="controls">
          <div class="search-box">
            <label for="searchInput">Ê§úÁ¥¢Ôºà‰æãÔºöAdo / „Ç∑„É£„É´„É´ / „Éú„Ç´„É≠ / Âºæ„ÅçË™û„Çä „Å™„Å©Ôºâ</label>
            <div class="search-input-wrap">
              <span class="search-icon">üîç</span>
              <input
                type="text"
                id="searchInput"
                placeholder="„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÁµû„ÇäËæº„Åø..."
              />
            </div>
          </div>

          <div class="filter-row" id="filterRow">
            <!-- JS„Åß„Éú„Çø„É≥„ÇíÂ∑Æ„ÅóËæº„ÇÄ -->
          </div>
        </div>
      </div>
    </header>

    <main id="songSections">
      <!-- JS„Åß„Ç´„ÉÜ„Ç¥„É™„Åî„Å®„ÅÆ„É™„Çπ„Éà„ÇíÊèèÁîª -->
    </main>

    <footer>
      Êõ¥Êñ∞Êó•: <span id="updatedDate"></span><br />
      ‚Äª Â∞ë„Åó„Åö„Å§Êõ≤„ÇíËøΩÂä†ÔºÜÊï¥ÁêÜ„Åó„Å¶„ÅÑ„Åç„Åæ„Åô
    </footer>
  </div>

  <script>
    // ======================
    // „Ç´„ÉÜ„Ç¥„É™ÂÆöÁæ©
    // ======================
    const CATEGORY_LABELS = {
      all: "„Åô„Åπ„Å¶",
      jpop: "J-POP / Ado / ÂÇòÊùë / Kanaria „Å™„Å©",
      anime: "„Ç¢„Éã„ÇΩ„É≥ / „Ç≤„Éº„ÇΩ„É≥",
      vocaloid: "„Éú„Ç´„É≠",
      other: "„Åù„ÅÆ‰ªñ",
      ng: "‰∫åÂ∫¶„Å®Ê≠å„ÅÑ„Åü„Åè„Å™„ÅÑ„ÇÑ„Å§",
      training: "È†ëÂºµ„Å£„Å¶Ë¶ö„Åà„Å¶„Çã„ÇÑ„Å§"
    };

    const CATEGORY_ORDER = ["jpop", "anime", "vocaloid", "other", "ng", "training"];

    let allSongs = [];
    let filteredCategory = "all";
    let keyword = "";

    const sectionsContainer = document.getElementById("songSections");
    const searchInput = document.getElementById("searchInput");
    const filterRow = document.getElementById("filterRow");
    /* ÈñãÈñâ„Éú„Çø„É≥Èñ¢ÈÄ£ */
    const controls = document.getElementById("controls");
    const controlsToggle = document.getElementById("controlsToggle");
    const controlsToggleLabel = document.getElementById("controlsToggleLabel");
    const controlsToggleIcon = document.getElementById("controlsToggleIcon");

    // ===== Ê§úÁ¥¢„Éë„Éç„É´„ÅÆÈñãÈñâ =====
    controlsToggle.addEventListener("click", () => {
    const isCollapsed = controls.classList.toggle("collapsed");
    if (isCollapsed) {
        controlsToggleLabel.textContent = "Ê§úÁ¥¢„ÉªÁµû„ÇäËæº„Åø„ÇíÈñã„Åè";
        controlsToggleIcon.textContent = "‚ñº";
    } else {
        controlsToggleLabel.textContent = "Ê§úÁ¥¢„ÉªÁµû„ÇäËæº„Åø„ÇíÈñâ„Åò„Çã";
        controlsToggleIcon.textContent = "‚ñ≤";
    }
    });
    // ======================
    // Êõ¥Êñ∞Êó•Ë°®Á§∫
    // ======================
    (function setUpdatedDate() {
      const updatedSpan = document.getElementById("updatedDate");
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth() + 1).padStart(2, "0");
      const d = String(today.getDate()).padStart(2, "0");
      updatedSpan.textContent = `${y}/${m}/${d}`;
    })();

    // ======================
    // songs.json Ë™≠„ÅøËæº„Åø
    // ======================
    async function loadSongs() {
      try {
        const res = await fetch("songs.json", { cache: "no-store" });
        if (!res.ok) {
          throw new Error("songs.json „ÅåË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü");
        }
        const data = await res.json();
        allSongs = Array.isArray(data) ? data : [];
        buildFilterButtons();
        render();
      } catch (err) {
        console.error(err);
        sectionsContainer.innerHTML =
          '<p class="empty-msg">Êõ≤„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ</p>';
      }
    }

    // ======================
    // „Éï„Ç£„É´„Çø„Éú„Çø„É≥ÁîüÊàê
    // ======================
    function buildFilterButtons() {
      // „Ç´„ÉÜ„Ç¥„É™„Åî„Å®„ÅÆÊõ≤Êï∞
      const counts = allSongs.reduce(
        (acc, song) => {
          const cat = song.category || "other";
          acc.all++;
          acc[cat] = (acc[cat] || 0) + 1;
          return acc;
        },
        { all: 0 }
      );

      const cats = ["all", ...CATEGORY_ORDER];

      filterRow.innerHTML = "";
      cats.forEach((key) => {
        const btn = document.createElement("button");
        btn.className = "filter-btn" + (key === filteredCategory ? " active" : "");
        btn.dataset.category = key;
        btn.textContent = CATEGORY_LABELS[key] || key;
        const countSpan = document.createElement("span");
        countSpan.className = "count";
        countSpan.textContent = counts[key] != null ? counts[key] : 0;
        btn.appendChild(countSpan);

        btn.addEventListener("click", () => {
          filteredCategory = key;
          document
            .querySelectorAll(".filter-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          render();
        });

        filterRow.appendChild(btn);
      });
    }

    // ======================
    // „É¨„É≥„ÉÄ„É™„É≥„Ç∞
    // ======================
    function render() {
      const kw = keyword.toLowerCase().trim();
      let songsToShow = allSongs.slice();

      // „Ç´„ÉÜ„Ç¥„É™Áµû„ÇäËæº„Åø
      if (filteredCategory !== "all") {
        songsToShow = songsToShow.filter(
          (s) => (s.category || "other") === filteredCategory
        );
      }

      // „Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢
      if (kw) {
        songsToShow = songsToShow.filter((s) => {
          const t = (s.title || "").toLowerCase();
          const a = (s.artist || "").toLowerCase();
          const m = (s.memo || "").toLowerCase();
          return `${t} ${a} ${m}`.includes(kw);
        });
      }

      if (songsToShow.length === 0) {
        sectionsContainer.innerHTML =
          '<p class="empty-msg">Êù°‰ª∂„Å´Âêà„ÅÜÊõ≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Ç≠„Éº„ÉØ„Éº„Éâ„ÇÑ„Ç´„ÉÜ„Ç¥„É™„ÇíÂ§â„Åà„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>';
        return;
      }

      // „Ç´„ÉÜ„Ç¥„É™„Åî„Å®„Å´„Ç∞„É´„Éº„Éî„É≥„Ç∞
      const groups = {};
      songsToShow.forEach((s) => {
        const cat = s.category || "other";
        if (!groups[cat]) groups[cat] = [];
        groups[cat].push(s);
      });

      // „ÅÑ„ÅÑÊÑü„Åò„ÅÆÈ†ÜÁï™„Åß‰∏¶„Åπ„Çã
      const order = CATEGORY_ORDER.filter((c) => groups[c]);
      const htmlParts = [];

      order.forEach((cat) => {
        const list = groups[cat];
        htmlParts.push(renderCategorySection(cat, list));
      });

      sectionsContainer.innerHTML = htmlParts.join("");
    }

    function renderCategorySection(catKey, songs) {
      const label =
        catKey === "jpop"
          ? "J-POP / Ado / ÂÇòÊùë„Éà„Éº„Çø / Kanaria „Å™„Å©"
          : catKey === "anime"
          ? "„Ç¢„Éã„ÇΩ„É≥ / „Ç≤„Éº„ÇΩ„É≥"
          : catKey === "vocaloid"
          ? "„Éú„Ç´„É≠"
          : catKey === "ng"
          ? "‰∫åÂ∫¶„Å®Ê≠å„ÅÑ„Åü„Åè„Å™„ÅÑ„ÇÑ„Å§"
          : catKey === "training"
          ? "È†ëÂºµ„Å£„Å¶Ë¶ö„Åà„Å¶„Çã„ÇÑ„Å§"
          : "„Åù„ÅÆ‰ªñ";

      const headerTitle =
        {
          jpop: "J-POP / „Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÁ≥ª",
          anime: "„Ç¢„Éã„ÇΩ„É≥ / „Ç≤„Éº„É†„ÇΩ„É≥„Ç∞",
          vocaloid: "„Éú„Ç´„É≠",
          other: "„Åù„ÅÆ‰ªñ",
          ng: "NG„É™„Çπ„ÉàÔºàÊ≠å„ÅÑ„Åü„Åè„Å™„ÅÑÔºâ",
          training: "Á∑¥Áøí‰∏≠„ÅÆÊõ≤"
        }[catKey] || "„Åù„ÅÆ‰ªñ";

      const rowsHtml = songs
        .map((s, index) => {
            const title = escapeHtml(s.title || "");
            const artist = escapeHtml(s.artist || "");
            const memo = s.memo || "";

            const memoPills = [];
            const rowClasses = [];

            if (/‰∫åÂ∫¶„Å®Ê≠å„ÅÑ„Åü„Åè„Å™„ÅÑ/.test(memo)) {
            memoPills.push(
                `<span class="memo-pill memo-ng">‰∫åÂ∫¶„Å®Ê≠å„ÅÑ„Åü„Åè„Å™„ÅÑ</span>`
            );
            rowClasses.push("row-ng");
            }
            if (/Á∑¥Áøí‰∏≠/.test(memo)) {
            memoPills.push(
                `<span class="memo-pill memo-training">Á∑¥Áøí‰∏≠</span>`
            );
            rowClasses.push("row-training");
            }
            if (/[-+]\d|\/\d{2}/.test(memo)) {
            memoPills.push(
                `<span class="memo-pill memo-key">„Ç≠„ÉºÊÉÖÂ†±„ÅÇ„Çä</span>`
            );
            }

            const memoText = memo
            ? `<div class="memo-text">${escapeHtml(memo)}</div>`
            : "";

            const extraClasses = rowClasses.length ? " " + rowClasses.join(" ") : "";

            return `
            <tr class="song-row${extraClasses}" style="--row-index:${index}">
                <td>
                <div class="song-title">${title}</div>
                </td>
                <td>
                <div class="song-artist">${artist || "&nbsp;"}</div>
                </td>
                <td>
                ${memoPills.join(" ")}
                ${memoText}
                </td>
            </tr>
            `;
        })
        .join("");


      return `
      <section class="category-section" data-category="${catKey}">
        <div class="category-header">
          <h2 class="category-title">${headerTitle}</h2>
          <span class="category-badge">${label}</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Êõ≤Âêç</th>
                <th>„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà</th>
                <th>„É°„É¢</th>
              </tr>
            </thead>
            <tbody>
              ${rowsHtml}
            </tbody>
          </table>
        </div>
      </section>
    `;
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // ======================
    // „Ç§„Éô„É≥„Éà
    // ======================
    searchInput.addEventListener("input", (e) => {
      keyword = e.target.value;
      render();
    });

    // ÂàùÊúü„É≠„Éº„Éâ
    loadSongs();
  </script>
</body>
</html>
