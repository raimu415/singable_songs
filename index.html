<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        /* å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: #f3f4ff;
            color: #222;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 12px 16px 32px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            text-align: center;
            margin-bottom: 16px;
        }
        h1 {
            font-size: 1.4rem;
            margin: 8px 0 4px;
        }
        .tagline {
            font-size: 0.9rem;
            color: #555;
        }
        .note {
            font-size: 0.8rem;
            color: #777;
        }

        /* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ */
        .search-box {
            margin: 16px 0 8px;
        }
        .search-box label {
            font-size: 0.85rem;
            color: #555;
            display: block;
            margin-bottom: 4px;
        }
        .search-box input {
            width: 100%;
            padding: 10px 12px;
            font-size: 1rem;
            border-radius: 999px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            outline: none;
        }
        .search-box input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99,102,241,0.2);
        }

        /* ã‚«ãƒ†ã‚´ãƒªè¦‹å‡ºã— */
        .category {
            margin-top: 24px;
        }
        .category h2 {
            font-size: 1.05rem;
            margin: 0 0 4px;
            padding-left: 8px;
            border-left: 4px solid #6366f1;
        }
        .category .count {
            font-size: 0.78rem;
            color: #666;
            margin-left: 4px;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¹ãƒãƒ›ã§ã‚‚è¦‹ã‚„ã™ã */
        .table-wrapper {
            margin-top: 6px;
            background: #ffffff;
            border-radius: 12px;
            padding: 4px;
            box-shadow: 0 2px 4px rgba(15,23,42,0.08);
            overflow-x: auto; /* ã¯ã¿å‡ºã—ãŸã‚‰æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            min-width: 320px;
        }
        th, td {
            padding: 6px 8px;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
            vertical-align: top;
        }
        th {
            font-size: 0.8rem;
            background: #f1f5f9;
            white-space: nowrap;
        }
        tr:last-child td {
            border-bottom: none;
        }

        /* ã‚¿ã‚°ã£ã½ã„ãƒ¡ãƒ¢è¡¨ç¤ºç”¨ */
        .memo {
            font-size: 0.78rem;
            color: #555;
        }

        /* è¡ŒãŒãƒ’ãƒƒãƒˆã—ãªã‹ã£ãŸã¨ãã«éè¡¨ç¤ºã«ã™ã‚‹ç”¨ */
        .hidden-row {
            display: none;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° / ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .status {
            margin-top: 12px;
            font-size: 0.85rem;
            color: #666;
            text-align: center;
        }
        .status.error {
            color: #b91c1c;
        }

        /* ãƒ•ãƒƒã‚¿ãƒ¼ */
        footer {
            margin-top: 24px;
            text-align: center;
            font-size: 0.75rem;
            color: #777;
        }

        /* ç”»é¢ãŒå°ã•ã„ã¨ãå°‘ã—æ–‡å­—å¤§ãã‚ã« */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.3rem;
            }
            table {
                font-size: 0.85rem;
            }
            th, td {
                padding: 6px 6px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ</h1>
        <div class="tagline">é…ä¿¡ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆOKãªæ›²ã‚’ã¾ã¨ã‚ã¾ã—ãŸ ğŸ¤</div>
        <div class="note">â€»æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãƒ»ãƒ¡ãƒ¢ã§æ¤œç´¢ã§ãã¾ã™</div>
    </header>

    <div class="search-box">
        <label for="searchInput">æ¤œç´¢ï¼ˆä¾‹ï¼šAdo / ã‚·ãƒ£ãƒ«ãƒ« / ãƒœã‚«ãƒ­ ãªã©ï¼‰</label>
        <input type="text" id="searchInput" placeholder="æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãƒ»ãƒ¡ãƒ¢ã§æ¤œç´¢...">
    </div>

    <div id="status" class="status">æ›²ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <!-- ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ JavaScript ã§è‡ªå‹•ç”Ÿæˆã™ã‚‹ -->
    <div id="categories-root"></div>

    <footer>
        æ›´æ–°æ—¥: <span id="updatedDate"></span><br>
        â€»å°‘ã—ãšã¤æ›²ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™
    </footer>
</div>

<script>
    // ---------------------------
    // è¨­å®š
    // ---------------------------
    const SONGS_JSON_URL = "songs.json"; // åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹å‰æ

    // ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ï¼ˆIDã¨è¡¨ç¤ºåï¼‰
    const CATEGORIES = [
        { id: "vocaloid", label: "ãƒœã‚«ãƒ­" },
        { id: "jpop",     label: "J-POP / ã‚¢ãƒ‹ã‚½ãƒ³" },
        { id: "anime",    label: "ã‚¢ãƒ‹ãƒ¡ã‚½ãƒ³ã‚°" },
        { id: "training", label: "ç·´ç¿’ä¸­" },
        { id: "ng",       label: "äºŒåº¦ã¨æ­Œã„ãŸããªã„ã‚„ã¤" },
        { id: "other",    label: "æ›²ã ã‘çŸ¥ã£ã¦ã‚‹æ›²" }
    ];

    // ---------------------------
    // æ—¥ä»˜è¡¨ç¤º
    // ---------------------------
    (function setUpdatedDate() {
        const updatedSpan = document.getElementById("updatedDate");
        const today = new Date();
        const y = today.getFullYear();
        const m = String(today.getMonth() + 1).padStart(2, "0");
        const d = String(today.getDate()).padStart(2, "0");
        updatedSpan.textContent = `${y}/${m}/${d}`;
    })();

    // ---------------------------
    // DOMç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
    // ---------------------------
    function createElement(tag, attrs = {}, children = []) {
        const el = document.createElement(tag);
        Object.entries(attrs).forEach(([key, value]) => {
            if (key === "class") el.className = value;
            else if (key === "text") el.textContent = value;
            else el.setAttribute(key, value);
        });
        children.forEach(child => el.appendChild(child));
        return el;
    }

    // ---------------------------
    // ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹
    // ---------------------------
    function createCategorySection(categoryId, label) {
        const tbody = createElement("tbody", {
            "data-category-body": categoryId
        });

        const table = createElement("table", {}, [
            createElement("thead", {}, [
                createElement("tr", {}, [
                    createElement("th", { text: "æ›²å" }),
                    createElement("th", { text: "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ" }),
                    createElement("th", { text: "ãƒ¡ãƒ¢" })
                ])
            ]),
            tbody
        ]);

        const wrapper = createElement("div", { class: "table-wrapper" }, [table]);

        const countSpan = createElement("span", {
            class: "count",
            "data-category-count": categoryId,
            text: "(0æ›²)"
        });

        const h2 = createElement("h2", {}, [
            document.createTextNode(label),
            countSpan
        ]);

        const section = createElement("section", {
            class: "category",
            "data-category-section": categoryId
        }, [
            h2,
            wrapper
        ]);

        return section;
    }

    // ---------------------------
    // æ¥½æ›²ãƒ†ãƒ¼ãƒ–ãƒ«ã®æç”»
    // ---------------------------
    let allRows = []; // æ¤œç´¢ç”¨ã«å…¨è¡Œã‚’ä¿æŒ

    function renderSongs(songs) {
        const root = document.getElementById("categories-root");
        root.innerHTML = ""; // ä¸€æ—¦ã‚¯ãƒªã‚¢
        allRows = [];

        if (!Array.isArray(songs) || songs.length === 0) {
            document.getElementById("status").textContent = "ã¾ã æ›²ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†ç”»é¢ã‹ã‚‰è¿½åŠ ã—ã¦ã­ã€‚";
            return;
        } else {
            document.getElementById("status").textContent = "";
        }

        // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«åˆ†é¡
        const grouped = {};
        CATEGORIES.forEach(cat => grouped[cat.id] = []);

        songs.forEach(song => {
            const cat = song.category || "other";
            if (!grouped[cat]) {
                grouped[cat] = [];
            }
            grouped[cat].push(song);
        });

        // ã‚«ãƒ†ã‚´ãƒªã®é †ç•ªã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        CATEGORIES.forEach(cat => {
            const list = grouped[cat.id] || [];
            if (list.length === 0) {
                // ãã®ã‚«ãƒ†ã‚´ãƒªã«æ›²ãŒãªã„å ´åˆã¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³è‡ªä½“ã‚’ä½œã‚‰ãªã„
                return;
            }

            const section = createCategorySection(cat.id, cat.label);
            root.appendChild(section);

            const tbody = section.querySelector(`[data-category-body="${cat.id}"]`);
            const countSpan = section.querySelector(`[data-category-count="${cat.id}"]`);
            countSpan.textContent = `(${list.length}æ›²)`;

            // æ›²ã”ã¨ã®è¡Œã‚’ä½œæˆ
            list.forEach(song => {
                const title  = song.title  || "";
                const artist = song.artist || "";
                const memo   = song.memo   || "";

                const tr = createElement("tr", {
                    "data-search-text": (title + " " + artist + " " + memo).toLowerCase()
                });

                const tdTitle = createElement("td", { "data-col": "title" });
                tdTitle.textContent = title;

                const tdArtist = createElement("td", { "data-col": "artist" });
                tdArtist.textContent = artist;

                const tdMemo = createElement("td", {
                    "data-col": "memo",
                    class: "memo"
                });
                tdMemo.textContent = memo;

                tr.appendChild(tdTitle);
                tr.appendChild(tdArtist);
                tr.appendChild(tdMemo);

                tbody.appendChild(tr);
                allRows.push(tr);
            });
        });

        if (root.children.length === 0) {
            document.getElementById("status").textContent = "ã¾ã æ›²ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†ç”»é¢ã‹ã‚‰è¿½åŠ ã—ã¦ã­ã€‚";
        }
    }

    // ---------------------------
    // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
    // ---------------------------
    function setupSearch() {
        const input = document.getElementById("searchInput");
        input.addEventListener("input", () => {
            const keyword = input.value.toLowerCase().trim();

            if (!keyword) {
                // ã‚¯ãƒªã‚¢æ™‚ã¯å…¨ã¦è¡¨ç¤º
                allRows.forEach(row => row.classList.remove("hidden-row"));
                document.getElementById("status").textContent = "";
                return;
            }

            let hitCount = 0;
            allRows.forEach(row => {
                const text = row.getAttribute("data-search-text") || "";
                if (text.includes(keyword)) {
                    row.classList.remove("hidden-row");
                    hitCount++;
                } else {
                    row.classList.add("hidden-row");
                }
            });

            const status = document.getElementById("status");
            if (hitCount === 0) {
                status.textContent = "è©²å½“ã™ã‚‹æ›²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
            } else {
                status.textContent = `${hitCount} æ›²ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚`;
            }
        });
    }

    // ---------------------------
    // JSONèª­ã¿è¾¼ã¿
    // ---------------------------
    async function loadSongs() {
        const status = document.getElementById("status");
        status.textContent = "æ›²ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...";

        try {
            const res = await fetch(SONGS_JSON_URL, {
                cache: "no-store"
            });

            if (!res.ok) {
                throw new Error(`HTTP ${res.status}`);
            }

            const data = await res.json();
            renderSongs(data);
        } catch (err) {
            console.error(err);
            status.textContent = "æ›²ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚";
            status.classList.add("error");
        }
    }

    // ---------------------------
    // åˆæœŸåŒ–
    // ---------------------------
    setupSearch();
    loadSongs();
</script>
</body>
</html>
