<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* =========================================================
   ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼å¤‰æ•°
========================================================= */
:root {
  --text-main: #e5e7eb;
  --text-sub: #9ca3af;
  --card-bg: rgba(15, 23, 42, 0.72);
  --card-border: rgba(56, 189, 248, 0.25);
  --accent: #60a5fa;
  --radius: 16px;
  --shadow: 0 8px 25px rgba(0, 0, 0, 0.35);
}

/* =========================================================
   ãƒ™ãƒ¼ã‚¹è¨­å®š
========================================================= */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", system-ui, sans-serif;
  color: var(--text-main);
  background: #000;
  overflow-x: hidden; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
}

/* ã¼ã‚„ã‘èƒŒæ™¯ */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: url("bg.jpg") center/cover no-repeat;
  filter: blur(12px) brightness(0.55);
  transform: scale(1.06);
  z-index: -5;
}

/* ãƒã‚ªãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at top left, rgba(79, 70, 229, 0.65), transparent 55%),
    radial-gradient(circle at bottom right, rgba(236, 72, 153, 0.5), transparent 55%),
    linear-gradient(to bottom, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.95));
  mix-blend-mode: screen;
  z-index: -4;
  pointer-events: none;
}

/* ã‚³ãƒ³ãƒ†ãƒŠ */
.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 16px 14px 40px;
  position: relative;
  z-index: 10;
}

/* =========================================================
   â˜…æ¿€å¤‰æ©Ÿèƒ½1ï¼šã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ç”»é¢ï¼ˆBoot Screenï¼‰
========================================================= */
#boot-screen {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 99999; /* æœ€å‰é¢ */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  padding: 20px 40px;
  font-family: "Courier New", monospace;
  color: #0f0; /* ãƒãƒƒã‚«ãƒ¼ã‚°ãƒªãƒ¼ãƒ³ */
  font-size: 1.2rem;
  line-height: 1.5;
  transition: opacity 0.8s ease;
}
#boot-screen.fadeout {
  opacity: 0;
  pointer-events: none;
}
.boot-log {
  margin: 2px 0;
  opacity: 0;
  animation: fadeInLog 0.1s forwards;
}
@keyframes fadeInLog { to { opacity: 1; } }

/* =========================================================
   â˜…æ¿€å¤‰æ©Ÿèƒ½2ï¼šãƒã‚¦ã‚¹ã®è»Œè·¡ï¼ˆCanvasï¼‰
========================================================= */
#cursor-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã‚’é‚ªé­”ã—ãªã„ */
  z-index: 9999; /* ã‚µã‚¤ãƒˆã‚ˆã‚Šæ‰‹å‰ã€Bootã‚ˆã‚Šå¥¥ */
}

/* =========================================================
   â˜…æ¿€å¤‰æ©Ÿèƒ½3ï¼šèƒŒæ™¯ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
========================================================= */
.visualizer-container {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 40vh; /* ç”»é¢ä¸‹åŠåˆ†ãã‚‰ã„ */
  display: flex;
  align-items: flex-end;
  justify-content: space-around;
  z-index: -3; /* èƒŒæ™¯ã®æ‰‹å‰ */
  pointer-events: none;
  opacity: 0.3; /* ã†ã£ã™ã‚‰è¡¨ç¤º */
  mask-image: linear-gradient(to top, black, transparent); /* ä¸Šã®æ–¹ã‚’ã¼ã‹ã™ */
}
.viz-bar {
  width: 10px;
  background: linear-gradient(to top, #60a5fa, #ec4899);
  border-radius: 5px 5px 0 0;
  animation: bounceBar infinite ease-in-out alternate;
}
@keyframes bounceBar {
  0% { height: 5%; }
  100% { height: 90%; }
}


/* =========================================================
   æ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ã‚«ãƒ¼ãƒ‰ãªã©ï¼‰
========================================================= */
header {
  position: sticky;
  top: 0;
  padding: 8px 0 10px;
  z-index: 30;
}

.header-inner {
  padding: 16px;
  background: rgba(15, 23, 42, 0.95);
  border-radius: 20px;
  border: 1px solid rgba(56, 189, 248, 0.25);
  box-shadow: var(--shadow);
}

h1 {
  margin: 0;
  font-size: 1.9rem;
  text-align: center;
  font-weight: 900;
  letter-spacing: 0.15em;
  /* ãƒã‚ªãƒ³å‘¼å¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
  animation: neonPulse 3s infinite alternate;
}

@keyframes neonPulse {
  0% { text-shadow: 0 0 6px rgba(75, 127, 255, 0.7), 0 0 15px rgba(56, 189, 248, 0.6); }
  100% { text-shadow: 0 0 10px rgba(75, 127, 255, 1), 0 0 25px rgba(56, 189, 248, 1), 0 0 40px rgba(96, 165, 250, 0.8); }
}

/* ã‚°ãƒªãƒƒãƒæ¼”å‡º */
@keyframes glitch-anim {
  0% { clip-path: inset(20% 0 50% 0); transform: translate(-2px, 3px); }
  10% { clip-path: inset(60% 0 10% 0); transform: translate(2px, -3px); }
  20% { clip-path: inset(40% 0 30% 0); transform: translate(-2px, 1px); }
  30% { clip-path: inset(80% 0 5% 0); transform: translate(2px, 2px); }
  40% { clip-path: inset(10% 0 70% 0); transform: translate(-2px, -2px); }
  50% { clip-path: inset(30% 0 20% 0); transform: translate(2px, 1px); }
  100% { clip-path: inset(50% 0 30% 0); transform: translate(0, 0); }
}

h1.glitch-effect { position: relative; color: white; }
h1.glitch-effect::before, h1.glitch-effect::after {
  content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent;
}
h1.glitch-effect::before {
  left: 2px; text-shadow: -1px 0 rgba(255,0,0,0.7); animation: glitch-anim 2s infinite linear alternate-reverse; clip-path: inset(0 0 0 0);
}
h1.glitch-effect::after {
  left: -2px; text-shadow: 1px 0 rgba(0,0,255,0.7); animation: glitch-anim 2.5s infinite linear alternate; clip-path: inset(0 0 0 0);
}

.tagline { text-align: center; font-size: 0.9rem; color: var(--text-sub); margin-top: 3px; }
.note { text-align: center; font-size: 0.75rem; margin-top: 2px; color: var(--text-sub); }

/* é–‹é–‰ãƒœã‚¿ãƒ³ */
.controls-toggle-row { margin-top: 8px; text-align: right; }
.controls-toggle {
  padding: 4px 12px; border-radius: 999px; font-size: 0.75rem;
  background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(148, 163, 184, 0.6);
  color: var(--text-main); cursor: pointer;
}

/* æ¤œç´¢ãƒ‘ãƒãƒ« */
.controls {
  margin-top: 12px; display: flex; flex-direction: column; gap: 10px;
  max-height: 500px; opacity: 1; overflow: hidden;
  transition: max-height 0.25s ease, opacity 0.2s ease;
}
.controls.collapsed { max-height: 0; opacity: 0; pointer-events: none; }

.search-box label { font-size: 0.78rem; margin-bottom: 4px; color: var(--text-sub); }
.search-input-wrap { position: relative; }
.search-box input {
  width: 100%; padding: 10px 12px 10px 34px; border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.7); background: rgba(15, 23, 42, 0.8); color: var(--text-main);
}
.search-icon { position: absolute; top: 50%; left: 10px; transform: translateY(-50%); opacity: 0.6; }

.sort-select {
  padding: 6px 12px; border-radius: 999px; border: 1px solid rgba(148, 163, 184, 0.7);
  background: rgba(15, 23, 42, 0.8); color: var(--text-main); font-size: 0.85rem; outline: none; cursor: pointer;
}
.sort-select:focus { border-color: var(--accent); box-shadow: 0 0 8px rgba(56, 189, 248, 0.5); }

/* ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³ */
.filter-row { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; }
.filter-btn {
  padding: 5px 10px; border-radius: 999px; background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.6); color: var(--text-sub); font-size: 0.75rem; cursor: pointer;
}
.filter-btn.active {
  background: linear-gradient(135deg, #4f46e5, #0ea5e9); color: #fff;
  border-color: rgba(56, 189, 248, 0.9); box-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
}

/* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ */
.song-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 14px; margin-top: 14px; }

/* ã‚«ãƒ¼ãƒ‰ */
.song-card {
  position: relative;
  background: radial-gradient(circle at top left, rgba(96,165,250,0.25), transparent 55%),
              radial-gradient(circle at bottom right, rgba(236,72,153,0.25), transparent 55%),
              rgba(15, 23, 42, 0.9);
  padding: 16px 20px; border-radius: 22px; border: 1px solid rgba(56, 189, 248, 0.7);
  backdrop-filter: blur(12px);
  box-shadow: 0 0 0 1px rgba(15,23,42,0.8), 0 16px 35px rgba(0,0,0,0.6), 0 0 25px rgba(59,130,246,0.35);
  overflow: hidden; opacity: 0; transform: translateY(20px) scale(0.97);
  animation: fadeUp 0.6s ease forwards;
  animation-delay: calc(var(--i) * 0.03s);
  
  /* 3Dè¨­å®š */
  perspective: 1000px; transform-style: preserve-3d;
}

.song-card > * { transform: translateZ(20px); }

/* ã‚«ãƒ¼ãƒ‰ã®å…‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
.song-card::before {
  content: ""; position: absolute; inset: -40%;
  background: conic-gradient(from 180deg, rgba(59,130,246,0.0), rgba(59,130,246,0.5), rgba(236,72,153,0.5), rgba(56,189,248,0.8), rgba(59,130,246,0.0));
  opacity: 0; mix-blend-mode: screen; filter: blur(22px);
  transform: rotate(0deg); transition: opacity 0.3s ease, transform 4s linear;
  pointer-events: none; z-index: 0;
}
.song-card::after {
  content: ""; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
  background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0) 100%);
  transform: skewX(-25deg); pointer-events: none; z-index: 1; transition: left 0.5s;
}

.song-card:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 0 0 1px rgba(56,189,248,0.6), 0 22px 45px rgba(15,23,42,0.95), 0 0 40px rgba(96,165,250,0.8); }
.song-card:hover::before { opacity: 0.95; transform: rotate(25deg); }
.song-card:hover::after { left: 150%; transition: left 0.7s ease-in-out; }

@keyframes fadeUp {
  0% { opacity: 0; transform: translateY(20px) scale(0.97); }
  60% { opacity: 1; transform: translateY(-2px) scale(1.02); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

.song-title { font-size: 1.1rem; font-weight: 800; letter-spacing: 0.04em; text-shadow: 0 0 10px rgba(59,130,246,0.9), 0 0 18px rgba(56,189,248,0.9); }
.song-artist { opacity: 0.9; margin-top: 3px; font-size: 0.9rem; color: #cbd5f5; }
.song-pills { margin-top: 6px; display: flex; flex-wrap: wrap; gap: 4px; }
.song-title, .song-artist, .song-pills, .memo-text, .card-actions { position: relative; z-index: 2; }

.memo-pill {
  display: inline-flex; align-items: center; gap: 4px; padding: 3px 9px;
  border-radius: 999px; font-size: 0.73rem; border: 1px solid rgba(255,255,255,0.35);
  background: rgba(15,23,42,0.9); box-shadow: 0 0 10px rgba(148,163,184,0.4), 0 0 18px rgba(15,23,42,0.9);
}
.memo-ng { background: radial-gradient(circle at top left, #fecaca, #b91c1c); color: #fff; border-color: rgba(254,202,202,0.9); box-shadow: 0 0 12px rgba(248,113,113,0.9); }
.memo-training { background: radial-gradient(circle at top left, #bfdbfe, #1d4ed8); color: #e0f2fe; border-color: rgba(191,219,254,0.9); box-shadow: 0 0 12px rgba(96,165,250,0.9); }
.memo-key { background: radial-gradient(circle at top left, #ddd6fe, #7c3aed); color: #f5f3ff; border-color: rgba(221,214,254,0.9); box-shadow: 0 0 12px rgba(129,140,248,0.9); }

.memo-text { font-size: 0.8rem; margin-top: 8px; opacity: 0.95; color: #e5e7f5; }
.category-title { margin: 22px 0 8px; padding-left: 12px; font-size: 1.15rem; border-left: 4px solid var(--accent); text-shadow: 0 0 10px rgba(59,130,246,0.9), 0 0 22px rgba(56,189,248,0.9); }

/* ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒœã‚¿ãƒ³ */
.roulette-btn {
  background: linear-gradient(45deg, #ff6b6b, #f06595); border: none; padding: 8px 24px;
  border-radius: 999px; color: #fff; font-weight: bold; font-size: 0.9rem; cursor: pointer;
  box-shadow: 0 4px 15px rgba(240, 101, 149, 0.4); transition: transform 0.2s, box-shadow 0.2s;
}
.roulette-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(240, 101, 149, 0.6); }
.roulette-btn:active { transform: scale(0.95); }

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
  z-index: 100; display: flex; justify-content: center; align-items: center; opacity: 0;
  pointer-events: none; transition: opacity 0.3s;
}
.modal-overlay.show { opacity: 1; pointer-events: auto; }
.modal-content {
  background: #1e293b; border: 1px solid var(--accent); padding: 40px; border-radius: 20px;
  text-align: center; max-width: 90%; width: 400px; box-shadow: 0 0 50px rgba(96, 165, 250, 0.5);
  transform: scale(0.8); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-title { color: var(--text-sub); font-size: 1rem; margin-bottom: 10px; }
.modal-result { font-size: 1.8rem; font-weight: 900; margin: 20px 0; color: #fff; text-shadow: 0 0 15px var(--accent); min-height: 3rem; display: flex; align-items: center; justify-content: center; line-height: 1.3; }
.modal-close { background: transparent; border: 1px solid var(--text-sub); color: var(--text-main); padding: 8px 24px; border-radius: 999px; cursor: pointer; margin-top: 10px; }
.modal-close:hover { background: rgba(255,255,255,0.1); }

/* YouTubeãƒ»ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ */
.card-actions { margin-top: 12px; display: flex; gap: 8px; align-items: center; }
.btn-youtube { display: inline-flex; align-items: center; gap: 4px; background: rgba(220, 38, 38, 0.2); color: #fca5a5; border: 1px solid rgba(220, 38, 38, 0.5); padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; text-decoration: none; transition: 0.2s; }
.btn-youtube:hover { background: rgba(220, 38, 38, 0.8); color: #fff; }
.btn-copy { background: transparent; border: 1px solid rgba(148, 163, 184, 0.4); color: var(--text-sub); padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; transition: 0.2s; }
.btn-copy:hover { border-color: var(--accent); color: var(--accent); background: rgba(56, 189, 248, 0.1); }

/* é€šçŸ¥ */
.toast-notification {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px);
  background: rgba(16, 185, 129, 0.9); color: #fff; padding: 8px 20px; border-radius: 999px;
  font-size: 0.85rem; box-shadow: 0 4px 15px rgba(0,0,0,0.5); opacity: 0;
  transition: transform 0.3s, opacity 0.3s; z-index: 200; pointer-events: none;
}
.toast-notification.show { transform: translateX(-50%) translateY(0); opacity: 1; }

/* èƒŒæ™¯ç²’å­ */
.background-lights { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; margin: 0; padding: 0; z-index: -1; pointer-events: none; }
.background-lights li { position: absolute; display: block; list-style: none; width: 20px; height: 20px; background: rgba(255, 255, 255, 0.15); bottom: -150px; border-radius: 50%; animation: floatUp 25s linear infinite; }
.background-lights li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
.background-lights li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
.background-lights li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
.background-lights li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
.background-lights li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
.background-lights li:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
.background-lights li:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
.background-lights li:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
.background-lights li:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
.background-lights li:nth-child(10){ left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }
@keyframes floatUp { 0% { transform: translateY(0) rotate(0deg); opacity: 0.5; } 100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; } }

</style>
</head>
<body>

<div id="boot-screen"></div>

<canvas id="cursor-canvas"></canvas>

<div class="visualizer-container" id="visualizer"></div>

<ul class="background-lights">
  <li></li><li></li><li></li><li></li><li></li>
  <li></li><li></li><li></li><li></li><li></li>
</ul>

<div class="container">

<header>
  <div class="header-inner">
    <div style="text-align:center; font-size:0.7rem; color:var(--text-sub); margin-bottom:4px; opacity:0.8;">
      Last Update: <span id="lastUpdateTime">--/-- --:--</span>
    </div>
    <h1 class="glitch-effect" data-text="ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ ğŸ¤">
     ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ ğŸ¤  
    </h1>
    <div class="tagline">é…ä¿¡ã§æ­Œãˆã‚‹ï¼ˆæ­Œã„ãŸã„ï¼‰æ›²ã‚’ã¾ã¨ã‚ãŸãƒšãƒ¼ã‚¸</div>
    <div class="note">æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»ãƒ¡ãƒ¢ã§æ¤œç´¢ã§ãã¾ã™</div>
    
    <div style="text-align:center; margin: 10px 0;">
      <button id="rouletteBtn" class="roulette-btn">ğŸ² ãŠã¾ã‹ã›é¸æ›²ï¼</button>
    </div>

    <div class="controls-toggle-row">
      <button id="controlsToggle" class="controls-toggle">
        <span id="toggleIcon">â–²</span> <span id="toggleLabel">æ¤œç´¢ã‚’é–‰ã˜ã‚‹</span>
      </button>
    </div>

    <div id="controls" class="controls">
      <div class="search-box">
        <label for="searchInput">æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
        <div class="search-input-wrap">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="searchInput" placeholder="ä¾‹ï¼šAdo / ç·´ç¿’ä¸­ ãªã©">
        </div>
        <div style="margin-top: 10px; display: flex; align-items: center; justify-content: flex-end; gap: 8px;">
          <label for="sortSelect" style="font-size:0.75rem; color:var(--text-sub); margin:0;">ä¸¦ã³æ›¿ãˆ:</label>
          <select id="sortSelect" class="sort-select">
            <option value="default">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆç™»éŒ²é †ï¼‰</option>
            <option value="artist">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆé † (ã‚ã„ã†ãˆãŠ)</option>
            <option value="title">æ›²åé † (ã‚ã„ã†ãˆãŠ)</option>
          </select>
        </div>
      </div>
      <div class="filter-row" id="filterRow" style="margin-top: 12px;"></div>
    </div>
  </div>
</header>

<main id="songSections"></main>

<footer style="text-align:center;margin-top:40px;color:#9ca3af;font-size:0.75rem;">
  æ›´æ–°æ—¥: <span id="updatedDate"></span>
</footer>

</div>

<div id="rouletteModal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-title">ğŸµ æ¬¡ã®æ›²ã¯...</div>
    <div id="rouletteResult" class="modal-result">???</div>
    <button id="closeModal" class="modal-close">é–‰ã˜ã‚‹</button>
  </div>
</div>

<div id="toast" class="toast-notification">âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>

<script>
// =========================================================
// 1. å®šæ•°ãƒ»å¤‰æ•°
// =========================================================
const CATEGORY_LABELS = {
  all: "ã™ã¹ã¦",
  jpop: "J-POP / ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ",
  anime: "ã‚¢ãƒ‹ã‚½ãƒ³ / ã‚²ãƒ¼ã‚½ãƒ³",
  vocaloid: "ãƒœã‚«ãƒ­",
  other: "ãã®ä»–",
  ng: "ğŸ™… NGï¼ˆæ­Œã„ãŸããªã„ï¼‰",
  training: "ğŸ”° ç·´ç¿’ä¸­",
  acoustic: "ğŸ¸ å¼¾ãèªã‚Š"
};
const CATEGORY_ORDER = ["jpop", "anime", "vocaloid", "other", "ng", "training", "acoustic"];
let allSongs = [];
let filteredCategory = "all";
let keyword = "";
let currentSort = "default";

const sectionsContainer = document.getElementById("songSections");
const searchInput = document.getElementById("searchInput");
const filterRow = document.getElementById("filterRow");
const controls = document.getElementById("controls");
const toggle = document.getElementById("controlsToggle");
const toggleIcon = document.getElementById("toggleIcon");
const toggleLabel = document.getElementById("toggleLabel");
const sortSelect = document.getElementById("sortSelect");
const rouletteBtn = document.getElementById("rouletteBtn");
const modal = document.getElementById("rouletteModal");
const modalResult = document.getElementById("rouletteResult");
const closeModal = document.getElementById("closeModal");

// =========================================================
// 2. åŸºæœ¬æ©Ÿèƒ½
// =========================================================
if(toggle){
  toggle.addEventListener("click", () => {
    const collapsed = controls.classList.toggle("collapsed");
    toggleIcon.textContent = collapsed ? "â–¼" : "â–²";
    toggleLabel.textContent = collapsed ? "æ¤œç´¢ã‚’é–‹ã" : "æ¤œç´¢ã‚’é–‰ã˜ã‚‹";
  });
}

function escape(str) {
  return String(str).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
}

function normalizeSongs(songs) {
  return songs.map(song => {
    if (song.category === "acoustic") return song;
    if (song.memo && song.memo.includes("å¼¾ãèªã‚Š")) return { ...song, category: "acoustic" };
    return song;
  });
}

(function(){
  const d = new Date(document.lastModified);
  const timeString = `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
  const h = document.getElementById("lastUpdateTime"); if(h) h.textContent = timeString;
  const f = document.getElementById("updatedDate"); if(f) f.textContent = timeString;
})();

// =========================================================
// 3. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
// =========================================================
async function loadSongs() {
  try {
    const res = await fetch("songs.json", { cache: "no-store" });
    if (!res.ok) throw new Error(res.status);
    const data = await res.json();
    allSongs = normalizeSongs(data);
    buildFilterButtons();
    render();
  } catch (e) {
    console.error(e);
    sectionsContainer.innerHTML = `<p style='text-align:center;margin-top:20px;'>èª­ã¿è¾¼ã¿å¤±æ•—: ${e.message}</p>`;
  }
}

// =========================================================
// 4. æç”»
// =========================================================
function buildFilterButtons() {
  if (!filterRow) return;
  const counts = allSongs.reduce((a,s)=>{
    const c = s.category || "other"; a.all++; a[c] = (a[c]||0)+1; return a;
  },{all:0});
  filterRow.innerHTML = "";
  ["all",...CATEGORY_ORDER].forEach(cat=>{
    const btn = document.createElement("button");
    btn.className = "filter-btn"+(cat===filteredCategory?" active":"");
    btn.innerHTML = `${CATEGORY_LABELS[cat]} <span class="count">(${counts[cat]||0})</span>`;
    btn.onclick = ()=>{
      filteredCategory = cat;
      document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      render();
    };
    filterRow.appendChild(btn);
  });
}

function render() {
  let list = allSongs.slice();
  if (filteredCategory !== "all") list = list.filter(s => (s.category || "other") === filteredCategory);
  const kw = keyword.toLowerCase();
  if (kw) list = list.filter(s => `${s.title||""} ${s.artist||""} ${s.memo||""}`.toLowerCase().includes(kw));
  
  if (currentSort === "artist") {
    list.sort((a,b)=> (a.artist||"").toString().localeCompare((b.artist||"").toString(),"ja"));
  } else if (currentSort === "title") {
    list.sort((a,b)=> (a.title||"").toString().localeCompare((b.title||"").toString(),"ja"));
  }

  if (!list.length) { sectionsContainer.innerHTML = "<p style='text-align:center;margin-top:20px;'>è©²å½“ãªã—</p>"; return; }

  const groups = {};
  list.forEach(s => { const c = s.category || "other"; if (!groups[c]) groups[c] = []; groups[c].push(s); });
  
  sectionsContainer.innerHTML = CATEGORY_ORDER.filter(c=>groups[c]).map(cat=> `
    <h2 class="category-title">${CATEGORY_LABELS[cat]}</h2>
    <div class="song-grid">${groups[cat].map((s,i)=>renderCard(s,i)).join("")}</div>
  `).join("");
}

function renderCard(s, i) {
  const title = escape(s.title), artist = escape(s.artist||""), memo = s.memo||"", url = s.url||"";
  const keyMatch = memo.match(/[-+]\d+/);
  const pills = [];
  if (/äºŒåº¦ã¨æ­Œã„ãŸããªã„/.test(memo)) pills.push(`<span class="memo-pill memo-ng">NG</span>`);
  if (/ç·´ç¿’ä¸­/.test(memo)) pills.push(`<span class="memo-pill memo-training">ç·´ç¿’ä¸­</span>`);
  if (keyMatch) pills.push(`<span class="memo-pill memo-key">ã‚­ãƒ¼ ${escape(keyMatch[0])}</span>`);
  
  let memoForView = memo;
  if (keyMatch) memoForView = memoForView.replace(keyMatch[0], "").trim().replace(/[\/ï½œ|ãƒ»:ï¼šã€ã€‚-]+$/,"").trim();
  const memoText = memoForView ? `<div class="memo-text">${escape(memoForView)}</div>` : "";

  const copyString = `${title} / ${artist}`;
  let actions = `<div class="card-actions">
    <button class="btn-copy" onclick="copyText('${copyString.replace(/'/g, "\\'")}')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>`;
  if(url) actions += `<a href="${escape(url)}" target="_blank" class="btn-youtube">â–¶ YouTube</a>`;
  actions += `</div>`;

  return `<div class="song-card" style="--i:${i}">
    <div class="song-title">${title}</div><div class="song-artist">${artist}</div>
    <div class="song-pills">${pills.join(" ")}</div>${memoText}${actions}</div>`;
}

function copyText(text) {
  navigator.clipboard.writeText(text).then(() => {
    const t = document.getElementById("toast");
    t.classList.add("show"); setTimeout(() => t.classList.remove("show"), 2000);
  }).catch(alert);
}

// =========================================================
// 5. ã‚¤ãƒ™ãƒ³ãƒˆ
// =========================================================
if(searchInput) searchInput.addEventListener("input", e=>{ keyword=e.target.value; render(); });
if(sortSelect) sortSelect.addEventListener("change", e=>{ currentSort=e.target.value; render(); });

if (rouletteBtn) {
  rouletteBtn.addEventListener("click", () => {
    let list = allSongs.slice();
    if (filteredCategory !== "all") list = list.filter(s => (s.category || "other") === filteredCategory);
    const kw = keyword.toLowerCase();
    if (kw) list = list.filter(s => `${s.title} ${s.artist} ${s.memo}`.toLowerCase().includes(kw));

    if (!list.length) return alert("æ›²ãŒã‚ã‚Šã¾ã›ã‚“");
    modal.classList.add("show"); modalResult.textContent = "æŠ½é¸ä¸­...";
    let c=0;
    const interval = setInterval(() => {
      modalResult.textContent = list[Math.floor(Math.random()*list.length)].title;
      c++;
      if(c>=20){
        clearInterval(interval);
        const w = list[Math.floor(Math.random()*list.length)];
        modalResult.innerHTML = `<div style="font-size:0.8em;opacity:0.8;">${w.artist}</div><div>${w.title}</div>`;
      }
    }, 80);
  });
}
if(closeModal) closeModal.addEventListener("click", ()=> modal.classList.remove("show"));

// 3D Tilt
document.addEventListener('mousemove', (e) => {
  const cards = document.querySelectorAll('.song-card');
  cards.forEach(card => {
    const rect = card.getBoundingClientRect();
    if (rect.top > window.innerHeight || rect.bottom < 0) return;
    const x = e.clientX - (rect.left + rect.width/2);
    const y = e.clientY - (rect.top + rect.height/2);
    card.style.transform = `perspective(1000px) rotateX(${y * -0.05}deg) rotateY(${x * 0.05}deg) scale(1.02)`;
  });
});
document.addEventListener('mouseleave', () => {
  document.querySelectorAll('.song-card').forEach(c => c.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)');
});


/* =========================================================
   â˜…æ¿€å¤‰æ©Ÿèƒ½ã®å®Ÿè£…ï¼ˆèµ·å‹•ç”»é¢ãƒ»ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒ»ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ï¼‰
   ========================================================= */

// 1. ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ¼”å‡º (Boot Screen)
const bootScreen = document.getElementById("boot-screen");
const bootLogs = [
  "INITIALIZING SYSTEM...",
  "CONNECTING TO DATABASE...",
  "LOADING SONG_LIST.JSON...",
  "OPTIMIZING VISUAL CORE...",
  "ACCESS GRANTED."
];

async function runBootSequence() {
  for (let i = 0; i < bootLogs.length; i++) {
    const p = document.createElement("div");
    p.className = "boot-log";
    p.textContent = "> " + bootLogs[i];
    bootScreen.appendChild(p);
    // ãƒ©ãƒ³ãƒ€ãƒ ãªå¾…ã¡æ™‚é–“ï¼ˆãã‚Œã£ã½ãã™ã‚‹ï¼‰
    await new Promise(r => setTimeout(r, 300 + Math.random() * 400));
  }
  // å®Œäº†å¾Œãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
  setTimeout(() => {
    bootScreen.classList.add("fadeout");
    // BootãŒçµ‚ã‚ã£ãŸã‚‰æ›²ã‚’èª­ã¿è¾¼ã‚€
    loadSongs();
  }, 600);
}
// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
window.addEventListener("DOMContentLoaded", runBootSequence);


// 2. ãƒã‚¦ã‚¹ã®ãƒã‚ªãƒ³è»Œè·¡ (Cursor Trail)
const canvas = document.getElementById("cursor-canvas");
const ctx = canvas.getContext("2d");
let particles = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

class Particle {
  constructor(x, y) {
    this.x = x; this.y = y;
    this.size = Math.random() * 5 + 1;
    this.speedX = Math.random() * 3 - 1.5;
    this.speedY = Math.random() * 3 - 1.5;
    this.color = `hsl(${Math.random() * 60 + 180}, 100%, 70%)`; // é’ã€œæ°´è‰²ç³»
    this.life = 1.0;
  }
  update() {
    this.x += this.speedX;
    this.y += this.speedY;
    this.size *= 0.95;
    this.life -= 0.02;
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.globalAlpha = this.life;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fill();
  }
}

// ãƒã‚¦ã‚¹ç§»å‹•æ™‚ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç™ºç”Ÿ
window.addEventListener("mousemove", (e) => {
  for(let i=0; i<3; i++){
    particles.push(new Particle(e.clientX, e.clientY));
  }
});

function animateParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let i = 0; i < particles.length; i++) {
    particles[i].update();
    particles[i].draw();
    if (particles[i].life <= 0 || particles[i].size <= 0.5) {
      particles.splice(i, 1);
      i--;
    }
  }
  requestAnimationFrame(animateParticles);
}
animateParticles();


// 3. èƒŒæ™¯ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ (Visualizer)
const vizContainer = document.getElementById("visualizer");
const barCount = 30; // ãƒãƒ¼ã®æœ¬æ•°

for (let i = 0; i < barCount; i++) {
  const bar = document.createElement("div");
  bar.className = "viz-bar";
  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ™‚é–“ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ã—ã¦ãƒãƒ©ãƒãƒ©ã«å‹•ã‹ã™
  bar.style.animationDuration = (0.5 + Math.random() * 0.5) + "s";
  vizContainer.appendChild(bar);
}

</script>
</body>
</html>