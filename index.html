<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* =========================================================
   ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼å¤‰æ•°
========================================================= */
:root {
  --text-main: #e5e7eb;
  --text-sub: #9ca3af;
  --card-bg: rgba(15, 23, 42, 0.72);
  --card-border: rgba(56, 189, 248, 0.25);
  --accent: #60a5fa;
  --radius: 16px;
  --shadow: 0 8px 25px rgba(0, 0, 0, 0.35);
}

/* =========================================================
   ãƒ™ãƒ¼ã‚¹è¨­å®š
========================================================= */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", system-ui, sans-serif;
  color: var(--text-main);
  background: #000;
}

/* ã¼ã‚„ã‘èƒŒæ™¯ */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: url("bg.jpg") center/cover no-repeat;
  filter: blur(12px) brightness(0.55);
  transform: scale(1.06);
  z-index: -2;
}

/* ãƒã‚ªãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at top left, rgba(79, 70, 229, 0.65), transparent 55%),
    radial-gradient(circle at bottom right, rgba(236, 72, 153, 0.5), transparent 55%),
    linear-gradient(to bottom, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.95));
  mix-blend-mode: screen;
  z-index: -1;
}

/* ã‚³ãƒ³ãƒ†ãƒŠ */
.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 16px 14px 40px;
}

/* =========================================================
   ãƒ˜ãƒƒãƒ€ãƒ¼
========================================================= */
header {
  position: sticky;
  top: 0;
  padding: 8px 0 10px;
  z-index: 30;
}

.header-inner {
  padding: 16px;
  background: rgba(15, 23, 42, 0.95);
  border-radius: 20px;
  border: 1px solid rgba(56, 189, 248, 0.25);
  box-shadow: var(--shadow);
}

h1 {
  margin: 0;
  font-size: 1.9rem;
  text-align: center;
  font-weight: 900;
  letter-spacing: 0.15em;
  text-shadow:
    0 0 6px rgba(75, 127, 255, 0.9),
    0 0 18px rgba(56, 189, 248, 0.9);
}

.tagline {
  text-align: center;
  font-size: 0.9rem;
  color: var(--text-sub);
  margin-top: 3px;
}

.note {
  text-align: center;
  font-size: 0.75rem;
  margin-top: 2px;
  color: var(--text-sub);
}

/* =========================================================
   æ¤œç´¢ã‚¨ãƒªã‚¢ï¼ˆé–‹é–‰å¼ï¼‰
========================================================= */

.controls-toggle-row {
  margin-top: 8px;
  text-align: right;
}

.controls-toggle {
  padding: 4px 12px;
  border-radius: 999px;
  font-size: 0.75rem;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.6);
  color: var(--text-main);
  cursor: pointer;
}

.controls {
  margin-top: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;

  max-height: 500px;
  opacity: 1;
  overflow: hidden;
  transition: max-height 0.25s ease, opacity 0.2s ease;
}

/* é–‰ã˜ãŸçŠ¶æ…‹ */
.controls.collapsed {
  max-height: 0;
  opacity: 0;
  pointer-events: none;
}

/* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ */
.search-box label {
  font-size: 0.78rem;
  margin-bottom: 4px;
  color: var(--text-sub);
}

.search-input-wrap {
  position: relative;
}

.search-box input {
  width: 100%;
  padding: 10px 12px 10px 34px;
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.7);
  background: rgba(15, 23, 42, 0.8);
  color: var(--text-main);
}

.search-icon {
  position: absolute;
  top: 50%;
  left: 10px;
  transform: translateY(-50%);
  opacity: 0.6;
}

/* ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³ */
.filter-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  justify-content: center;
}

.filter-btn {
  padding: 5px 10px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.6);
  color: var(--text-sub);
  font-size: 0.75rem;
  cursor: pointer;
}

.filter-btn.active {
  background: linear-gradient(135deg, #4f46e5, #0ea5e9);
  color: #fff;
  border-color: rgba(56, 189, 248, 0.9);
  box-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
}

/* =========================================================
   ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆã“ã“ãŒãƒ¡ã‚¤ãƒ³ï¼ï¼‰
========================================================= */

.song-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 14px;
  margin-top: 14px;
}

/* 1æ›²ã®ã‚«ãƒ¼ãƒ‰ */
.song-card {
  background: var(--card-bg);
  padding: 14px 18px;
  border-radius: var(--radius);
  border: 1px solid var(--card-border);
  backdrop-filter: blur(8px);
  box-shadow: var(--shadow);

  opacity: 0;
  transform: translateY(20px);
  animation: fadeUp 0.5s ease forwards;
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å€‹åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¤ */
.song-card {
  animation-delay: calc(var(--i) * 0.03s);
}

@keyframes fadeUp {
  0% { opacity: 0; transform: translateY(20px) scale(0.97); }
  60% { opacity: 1; transform: translateY(-2px) scale(1.02); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

/* ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ */
.song-title {
  font-size: 1.05rem;
  font-weight: 700;
}

.song-artist {
  opacity: 0.75;
  margin-top: 2px;
  font-size: 0.88rem;
}

/* ãƒ¡ãƒ¢ãƒ”ãƒ« */
.memo-pill {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: 0.73rem;
  margin-right: 4px;
  border: 1px solid rgba(255,255,255,0.2);
}

/* è‰²åˆ¥ */
.memo-ng {
  background: rgba(185, 28, 28, 0.7);
  color: #fff;
}
.memo-training {
  background: rgba(8, 105, 161, 0.7);
  color: #e0f2fe;
}
.memo-key {
  background: rgba(124, 58, 237, 0.7);
  color: #fff;
}

/* ãƒ¡ãƒ¢æ–‡ç«  */
.memo-text {
  font-size: 0.8rem;
  margin-top: 4px;
  opacity: 0.9;
}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ« */
.category-title {
  margin: 18px 0 6px;
  padding-left: 10px;
  font-size: 1.1rem;
  border-left: 3px solid var(--accent);
  text-shadow: 0 0 6px rgba(59,130,246,0.6);
}

.category-badge {
  font-size: 0.75rem;
  color: var(--text-sub);
}
</style>

</head>
<body>

<div class="container">

<header>
  <div class="header-inner">

    <h1>ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ ğŸ¤</h1>
    <div class="tagline">é…ä¿¡ã§æ­Œãˆã‚‹ï¼ˆæ­Œã„ãŸã„ï¼‰æ›²ã‚’ã¾ã¨ã‚ãŸãƒšãƒ¼ã‚¸</div>
    <div class="note">æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»ãƒ¡ãƒ¢ã§æ¤œç´¢ã§ãã¾ã™</div>

    <!-- é–‹é–‰ãƒœã‚¿ãƒ³ -->
    <div class="controls-toggle-row">
      <button id="controlsToggle" class="controls-toggle">
        <span id="toggleIcon">â–²</span> <span id="toggleLabel">æ¤œç´¢ã‚’é–‰ã˜ã‚‹</span>
      </button>
    </div>

    <!-- æ¤œç´¢ãƒ‘ãƒãƒ« -->
    <div id="controls" class="controls">
      <div class="search-box">
        <label for="searchInput">æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
        <div class="search-input-wrap">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="searchInput" placeholder="ä¾‹ï¼šAdo / ç·´ç¿’ä¸­ ãªã©">
        </div>
      </div>

      <div class="filter-row" id="filterRow"></div>
    </div>

  </div>
</header>

<main id="songSections"></main>

<footer style="text-align:center;margin-top:40px;color:#9ca3af;font-size:0.75rem;">
  æ›´æ–°æ—¥: <span id="updatedDate"></span>
</footer>

</div>

<!-- ================= JS ================= -->
<script>
const CATEGORY_LABELS = {
  all: "ã™ã¹ã¦",
  jpop: "J-POP / ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆç³»",
  anime: "ã‚¢ãƒ‹ã‚½ãƒ³ / ã‚²ãƒ¼ã‚½ãƒ³",
  vocaloid: "ãƒœã‚«ãƒ­",
  other: "ãã®ä»–",
  ng: "NGï¼ˆæ­Œã„ãŸããªã„ï¼‰",
  training: "ç·´ç¿’ä¸­",
  acoustic: "å¼¾ãèªã‚Š"
};

const CATEGORY_ORDER = ["jpop", "anime", "vocaloid", "other", "ng", "training", "acoustic"];

let allSongs = [];
let filteredCategory = "all";
let keyword = "";

const sectionsContainer = document.getElementById("songSections");
const searchInput = document.getElementById("searchInput");
const filterRow = document.getElementById("filterRow");
const controls = document.getElementById("controls");
const toggle = document.getElementById("controlsToggle");
const toggleIcon = document.getElementById("toggleIcon");
const toggleLabel = document.getElementById("toggleLabel");

toggle.addEventListener("click", () => {
  const collapsed = controls.classList.toggle("collapsed");
  toggleIcon.textContent = collapsed ? "â–¼" : "â–²";
  toggleLabel.textContent = collapsed ? "æ¤œç´¢ã‚’é–‹ã" : "æ¤œç´¢ã‚’é–‰ã˜ã‚‹";
});

/* æ›´æ–°æ—¥ */
(function(){
  const el = document.getElementById("updatedDate");
  const t = new Date();
  el.textContent = `${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`;
})();

/* JSON èª­ã¿è¾¼ã¿ */
async function loadSongs() {
  try {
    const res = await fetch("songs.json", { cache: "no-store" });
    allSongs = await res.json();
    buildFilterButtons();
    render();
  } catch (e) {
    sectionsContainer.innerHTML = "<p style='text-align:center'>æ›²ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—</p>";
  }
}

/* ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³ */
function buildFilterButtons() {
  const counts = allSongs.reduce((a,s)=>{
    const c = s.category || "other";
    a.all++;
    a[c] = (a[c]||0)+1;
    return a;
  },{all:0});

  filterRow.innerHTML = "";

  ["all",...CATEGORY_ORDER].forEach(cat=>{
    const btn = document.createElement("button");
    btn.className = "filter-btn"+(cat===filteredCategory?" active":"");
    btn.dataset.category = cat;
    btn.innerHTML = `${CATEGORY_LABELS[cat]} <span class="count">(${counts[cat]||0})</span>`;
    btn.onclick = ()=>{
      filteredCategory = cat;
      document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      render();
    };
    filterRow.appendChild(btn);
  });
}

/* ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */
function render() {
  let list = allSongs.slice();

  if (filteredCategory!=="all") {
    list = list.filter(s => (s.category || "other") === filteredCategory);
  }

  const kw = keyword.toLowerCase();
  if (kw) {
    list = list.filter(s =>
      `${s.title||""} ${s.artist||""} ${s.memo||""}`.toLowerCase().includes(kw)
    );
  }

  if (!list.length) {
    sectionsContainer.innerHTML = "<p style='text-align:center;margin-top:20px;'>è©²å½“ã™ã‚‹æ›²ãŒã‚ã‚Šã¾ã›ã‚“</p>";
    return;
  }

  const groups = {};
  list.forEach(s=>{
    const c = s.category || "other";
    if (!groups[c]) groups[c] = [];
    groups[c].push(s);
  });

  const html = CATEGORY_ORDER.filter(c=>groups[c]).map(cat=>{
    return renderCategorySection(cat, groups[cat]);
  }).join("");

  sectionsContainer.innerHTML = html;
   // â˜… ãƒ¡ãƒ¢ã«ã€Œå¼¾ãèªã‚Šã€ãŒã‚ã£ãŸã‚‰ã‚«ãƒ†ã‚´ãƒªã‚’ acoustic ã«ã™ã‚‹
  allSongs = allSongs.map(song => {
    if (song.memo && song.memo.includes("å¼¾ãèªã‚Š")) {
      return { ...song, category: "acoustic" };
    }
    return song;
  });
}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æç”»ï¼ˆã‚«ãƒ¼ãƒ‰ç‰ˆï¼‰ */
function renderCategorySection(cat, list) {
  return `
    <h2 class="category-title">${CATEGORY_LABELS[cat]}</h2>
    <div class="song-grid">
      ${list.map((s,i)=>renderCard(s,i)).join("")}
    </div>
  `;
}

/* ã‚«ãƒ¼ãƒ‰1æš */
function renderCard(s, i) {
  const title = escape(s.title);
  const artist = escape(s.artist || "");
  const memo = s.memo || "";

  const pills = [];
  if (/äºŒåº¦ã¨æ­Œã„ãŸããªã„/.test(memo)) pills.push(`<span class="memo-pill memo-ng">NG</span>`);
  if (/ç·´ç¿’ä¸­/.test(memo)) pills.push(`<span class="memo-pill memo-training">ç·´ç¿’ä¸­</span>`);
  if (/[-+]\d|\/\d{2}/.test(memo)) pills.push(`<span class="memo-pill memo-key">ã‚­ãƒ¼</span>`);

  const memoText = memo ? `<div class="memo-text">${escape(memo)}</div>` : "";

  return `
    <div class="song-card" style="--i:${i}">
      <div class="song-title">${title}</div>
      <div class="song-artist">${artist}</div>
      <div class="song-pills">${pills.join(" ")}</div>
      ${memoText}
    </div>
  `;
}

function escape(str) {
  return String(str)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;");
}

/* å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ */
searchInput.addEventListener("input", (e)=>{
  keyword = e.target.value;
  render();
});

loadSongs();

</script>

</body>
</html>
