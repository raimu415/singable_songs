<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ - SYSTEM ONLINE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* =========================================================
   ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ & è¨­å®š
========================================================= */
:root {
  --text-main: #e5e7eb;
  --text-sub: #9ca3af;
  --accent: #60a5fa;
  --neon-pink: #ec4899;
  --neon-blue: #60a5fa;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", "Roboto", system-ui, sans-serif;
  color: var(--text-main);
  background: #000; /* èƒŒæ™¯ã¯Canvasã§æç”»ã™ã‚‹ã®ã§é»’ */
  overflow-x: hidden;
}

/* ã‚³ãƒ³ãƒ†ãƒŠ */
.container {
  max-width: 960px; margin: 0 auto; padding: 16px 14px 40px;
  position: relative; z-index: 10;
}

/* =========================================================
   èƒŒæ™¯ãƒ»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼
========================================================= */
/* ãƒãƒˆãƒªãƒƒã‚¯ã‚¹èƒŒæ™¯ */
#matrix-canvas {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  z-index: -10; opacity: 0.4; /* æ–‡å­—ãŒèª­ã‚ã‚‹ã‚ˆã†ã«è–„ã */
}

/* èƒŒæ™¯ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ */
.visualizer-container {
  position: fixed; bottom: 0; left: 0; width: 100%; height: 50vh;
  display: flex; align-items: flex-end; justify-content: space-around;
  z-index: -5; pointer-events: none; opacity: 0.5;
  mask-image: linear-gradient(to top, black, transparent 80%);
}
.viz-bar {
  width: 8px; margin: 0 2px;
  background: linear-gradient(to top, var(--neon-blue), var(--neon-pink));
  box-shadow: 0 0 10px var(--neon-blue);
  animation: bounceBar infinite ease-in-out alternate;
}
@keyframes bounceBar {
  0% { height: 2%; opacity: 0.3; }
  100% { height: 80%; opacity: 1; filter: brightness(1.5); }
}

/* ã‚«ãƒ¼ã‚½ãƒ«è»Œè·¡ */
#cursor-canvas {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 9990; mix-blend-mode: screen;
}

/* èµ·å‹•ç”»é¢ */
#boot-screen {
  position: fixed; inset: 0; background: #000; z-index: 99999;
  display: flex; flex-direction: column; justify-content: flex-end;
  padding: 40px; font-family: "Courier New", monospace; color: #0f0;
  font-size: 1rem; line-height: 1.4; transition: opacity 0.5s ease;
}
#boot-screen.fadeout { opacity: 0; pointer-events: none; }
.boot-log { animation: swiftUp 0.2s ease-out forwards; }
@keyframes swiftUp { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform:translateY(0); } }

/* =========================================================
   UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
========================================================= */
header { position: sticky; top: 0; padding: 8px 0 10px; z-index: 30; }
.header-inner {
  padding: 16px; background: rgba(15, 23, 42, 0.9);
  border-radius: 20px; border: 1px solid rgba(96, 165, 250, 0.3);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px);
}

h1 {
  margin: 0; font-size: 1.9rem; text-align: center; font-weight: 900;
  letter-spacing: 0.15em; color: #fff;
  text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), 0 0 20px var(--neon-pink);
}
/* ã‚¿ã‚¤ãƒˆãƒ«ã‚°ãƒªãƒƒãƒ(ã“ã“ã¯æ®‹ã—ã¾ã™ï¼šã‚¿ã‚¤ãƒˆãƒ«ã ã‘ã‚«ãƒƒã‚³ã‚ˆãæºã‚Œã‚‹) */
h1.glitch-effect { position: relative; animation: textGlitch 3s infinite alternate; }
@keyframes textGlitch {
  0%, 100% { transform: translate(0); opacity: 1; }
  92% { transform: translate(0); opacity: 1; }
  94% { transform: translate(-3px, 2px) skew(10deg); opacity: 0.8; text-shadow: -2px 0 red, 2px 0 blue; }
  96% { transform: translate(3px, -2px) skew(-10deg); opacity: 0.8; text-shadow: 2px 0 red, -2px 0 blue; }
  98% { transform: translate(0); opacity: 1; }
}

.tagline, .note { text-align: center; color: var(--text-sub); font-size: 0.8rem; }

/* æ¤œç´¢ãƒ»ãƒœã‚¿ãƒ³é¡ */
.controls-toggle-row { margin-top: 8px; text-align: right; }
.controls-toggle, .filter-btn, .sort-select, .search-box input {
  background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(148, 163, 184, 0.5);
  color: var(--text-main); border-radius: 999px; transition: all 0.2s;
}
.filter-btn.active {
  background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink));
  border-color: transparent; color: #fff; box-shadow: 0 0 15px var(--neon-blue);
}
.controls { max-height: 500px; overflow: hidden; transition: 0.3s ease; }
.controls.collapsed { max-height: 0; opacity: 0; pointer-events: none; }

/* =========================================================
   ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ›ãƒ­ã‚°ãƒ©ãƒ é€²åŒ–ç‰ˆï¼‰
========================================================= */
.song-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin-top: 20px; }

.song-card {
  position: relative; padding: 16px 20px; border-radius: 16px;
  background: rgba(15, 23, 42, 0.6);
  border: 1px solid rgba(96, 165, 250, 0.3);
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  backdrop-filter: blur(5px); overflow: hidden;
  perspective: 1000px; transform-style: preserve-3d;
  transition: transform 0.1s ease-out, box-shadow 0.2s, border-color 0.2s;
  animation: fadeUp 0.5s ease forwards;
  animation-delay: calc(var(--i) * 0.03s); opacity: 0;
}
@keyframes fadeUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

.song-card > * { transform: translateZ(20px); position: relative; z-index: 2; }

/* ãƒ›ãƒãƒ¼æ™‚ã®å¼·åŠ›ãªç™ºå…‰ã¨ã‚¹ã‚­ãƒ£ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
.song-card:hover {
  border-color: var(--neon-blue);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.6), inset 0 0 10px rgba(96, 165, 250, 0.3);
}
/* ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³ */
.song-card::after {
  content: ""; position: absolute; top: -50%; left: 0; width: 100%; height: 20px;
  background: linear-gradient(to bottom, transparent, var(--neon-blue), transparent);
  opacity: 0; z-index: 1; pointer-events: none;
  filter: blur(4px) brightness(2);
}
.song-card:hover::after {
  opacity: 1;
  animation: scanline 1.2s ease-in-out infinite;
}
@keyframes scanline {
  0% { top: -20%; opacity: 0; }
  10% { opacity: 1; }
  100% { top: 120%; opacity: 0; }
}

.song-title { font-size: 1.1rem; font-weight: 900; text-shadow: 0 0 10px var(--neon-blue); }
.song-artist { font-size: 0.9rem; color: #cbd5f5; opacity: 0.9; }
.memo-pill {
  font-size: 0.7rem; padding: 2px 8px; border-radius: 999px;
  background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.3);
  box-shadow: 0 0 5px rgba(255,255,255,0.2);
}
.memo-ng { border-color: #f87171; color: #f87171; box-shadow: 0 0 5px #f87171; }
.memo-training { border-color: var(--neon-blue); color: var(--neon-blue); box-shadow: 0 0 5px var(--neon-blue); }
.memo-key { border-color: var(--neon-pink); color: var(--neon-pink); box-shadow: 0 0 5px var(--neon-pink); }

/* ãã®ä»–ãƒ¢ãƒ¼ãƒ€ãƒ«ã€ãƒœã‚¿ãƒ³é¡ */
.roulette-btn {
  background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue)); border: none;
  padding: 10px 30px; border-radius: 999px; color: #fff; font-weight: bold; cursor: pointer;
  box-shadow: 0 0 20px var(--neon-pink); transition: 0.2s;
}
.roulette-btn:hover { transform: scale(1.05); box-shadow: 0 0 40px var(--neon-pink); filter: brightness(1.2); }

.modal-overlay { position: fixed; inset:0; background: rgba(0,0,0,0.8); z-index: 100; display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:0.3s; backdrop-filter:blur(5px); }
.modal-overlay.show { opacity:1; pointer-events:auto; }
.modal-content { background: #1e293b; border: 2px solid var(--neon-blue); padding: 30px; border-radius: 20px; text-align:center; width:90%; max-width:400px; box-shadow: 0 0 50px var(--neon-blue); transform: scale(0.8); transition: 0.3s; }
.modal-overlay.show .modal-content { transform: scale(1); }
.modal-result { font-size: 2rem; font-weight:900; margin: 20px 0; text-shadow: 0 0 20px var(--neon-blue); }

.toast-notification { position:fixed; bottom:30px; left:50%; transform:translate(-50%, 50px); background: var(--neon-blue); color:#fff; padding:8px 24px; border-radius:999px; box-shadow: 0 0 20px var(--neon-blue); opacity:0; transition:0.3s; z-index:200; }
.toast-notification.show { transform:translate(-50%, 0); opacity:1; }

/* =========================================================
   ğŸ“± ã‚¹ãƒãƒ›å°‚ç”¨ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨­å®š (PCã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“)
   ========================================================= */
@media screen and (max-width: 768px) {

  /* --- 1. ãƒ˜ãƒƒãƒ€ãƒ¼ã¨æ¤œç´¢ã‚¨ãƒªã‚¢ã®çœã‚¹ãƒšãƒ¼ã‚¹åŒ– --- */
  .container {
    padding: 10px 10px 80px; /* ä½™ç™½ã‚’æ¸›ã‚‰ã™ */
  }
  
  .header-inner {
    padding: 12px; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®å†…å´ã‚’ç‹­ã */
  }

  h1 {
    font-size: 1.3rem; /* ã‚¿ã‚¤ãƒˆãƒ«ã‚’å°ã•ã */
    letter-spacing: 0.05em;
  }
  
  /* ã‚¹ãƒãƒ›ã§ã¯ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ãªã©ã‚’éš ã—ã¦å ´æ‰€ã‚’ç©ºã‘ã‚‹ */
  .tagline, .note {
    display: none; 
  }

  /* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹å‘¨ã‚Šã‚’ã‚®ãƒ¥ãƒƒã¨è©°ã‚ã‚‹ */
  .controls-toggle-row { margin-top: 4px; }
  .controls { gap: 6px; }
  
  .search-box input,
  .sort-select {
    padding: 8px 12px;
    font-size: 0.8rem; /* æ–‡å­—ã‚µã‚¤ã‚ºèª¿æ•´ */
  }

  /* ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³ã‚’å°ã•ã */
  .filter-btn {
    padding: 4px 8px;
    font-size: 0.65rem;
  }

  /* --- 2. æ›²ãƒªã‚¹ãƒˆã‚’ã€Œ2åˆ—è¡¨ç¤ºã€ã«ã™ã‚‹ --- */
  .song-grid {
    /* 1åˆ—ã«ãªã‚‰ãšã€å¼·åˆ¶çš„ã«2åˆ—ã«ã™ã‚‹è¨­å®š */
    grid-template-columns: repeat(2, 1fr); 
    gap: 8px; /* ã‚«ãƒ¼ãƒ‰é–“ã®éš™é–“ã‚’ç‹­ã */
  }

  /* --- 3. ã‚«ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ç”¨ã«å°ã•ãã™ã‚‹ --- */
  .song-card {
    padding: 10px; /* ã‚«ãƒ¼ãƒ‰ã®å†…å´ã®ä½™ç™½ã‚’æ¸›ã‚‰ã™ */
    border-radius: 12px;
  }
  
  /* 3Då›è»¢ã¯ã‚¹ãƒãƒ›ã ã¨æ“ä½œã—ã«ãã„ï¼†é‡ã„ã®ã§OFFã«ã™ã‚‹ */
  .song-card {
    transform: none !important; 
    perspective: none;
  }
  /* æ–‡å­—ã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
  .song-title { font-size: 0.85rem; }
  .song-artist { font-size: 0.7rem; }
  
  /* ãƒ¡ãƒ¢ã‚„ãƒœã‚¿ãƒ³é¡ã‚‚å°ã•ã */
  .memo-text { font-size: 0.65rem; line-height: 1.2; }
  .memo-pill { font-size: 0.6rem; padding: 1px 6px; }
  
  .btn-copy, .btn-youtube {
    font-size: 0.6rem;
    padding: 3px 6px;
  }
  
  /* ãƒœã‚¿ãƒ³ãŒã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã«æŠ˜ã‚Šè¿”ã™ */
  .card-actions {
    flex-wrap: wrap;
  }

  /* --- 4. ãã®ä»–èª¿æ•´ --- */
  /* ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’å°‘ã—å°ã•ã */
  .roulette-btn {
    padding: 6px 16px;
    font-size: 0.8rem;
  }
  
  /* èµ·å‹•æ¼”å‡ºã®æ–‡å­—ã‚’å°ã•ãï¼ˆã¯ã¿å‡ºã—é˜²æ­¢ï¼‰ */
  #boot-screen {
    padding: 20px;
    font-size: 0.8rem;
  }
}

</style>
</head>
<body>

<div id="boot-screen"></div>
<canvas id="matrix-canvas"></canvas>
<canvas id="cursor-canvas"></canvas>
<div class="visualizer-container" id="visualizer"></div>

<div class="container">
  <header>
    <div class="header-inner">
      <div style="text-align:center; font-size:0.7rem; color:var(--text-sub); opacity:0.8;">Last Update: <span id="lastUpdateTime">--</span></div>
      <h1 class="glitch-effect" data-text="ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ ğŸ¤">ã‚‰ã„ã‚€ã®æ­Œãˆã‚‹æ›²ãƒªã‚¹ãƒˆ ğŸ¤</h1>
      <div class="tagline">é…ä¿¡ã§æ­Œãˆã‚‹ï¼ˆæ­Œã„ãŸã„ï¼‰æ›²ã‚’ã¾ã¨ã‚ãŸãƒšãƒ¼ã‚¸</div>
      
      <div style="text-align:center; margin: 15px 0;">
        <button id="rouletteBtn" class="roulette-btn">ğŸ² ã‚µã‚¤ãƒãƒ¼ãŠã¾ã‹ã›é¸æ›²</button>
      </div>

      <div class="controls-toggle-row">
        <button id="controlsToggle" class="controls-toggle">â–² æ¤œç´¢ã‚’é–‰ã˜ã‚‹</button>
      </div>
      <div id="controls" class="controls">
        <div style="margin: 10px 0; display:flex; gap:10px; flex-wrap:wrap;">
          <input type="text" id="searchInput" placeholder="ğŸ” æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰..." style="flex:1; padding:8px 16px;">
          <select id="sortSelect" class="sort-select">
            <option value="default">ç™»éŒ²é †</option>
            <option value="artist">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆé †</option>
            <option value="title">æ›²åé †</option>
          </select>
        </div>
        <div class="filter-row" id="filterRow"></div>
      </div>
    </div>
  </header>

  <main id="songSections"></main>

  <footer style="text-align:center; margin-top:40px; color:var(--text-sub); font-size:0.75rem;">
    æ›´æ–°æ—¥: <span id="updatedDate"></span>
  </footer>
</div>

<div id="rouletteModal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-title">Target Acquired:</div>
    <div id="rouletteResult" class="modal-result">???</div>
    <button id="closeModal" class="filter-btn" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
  </div>
</div>
<div id="toast" class="toast-notification">DATA COPIED TO CLIPBOARD</div>

<script>
// =========================================================
// JS: åŸºæœ¬è¨­å®šï¼†ãƒ‡ãƒ¼ã‚¿ç®¡ç†
// =========================================================
const CATEGORY_LABELS = { all:"ALL", jpop:"J-POP", anime:"ANIME/GAME", vocaloid:"VOCALOID", other:"OTHER", ng:"NG", training:"TRAINING", acoustic:"ACOUSTIC" };
const CATEGORY_ORDER = ["jpop", "anime", "vocaloid", "other", "ng", "training", "acoustic"];
let allSongs=[], filteredCategory="all", keyword="", currentSort="default";

// è¦ç´ å–å¾—
const els = {
  sections: document.getElementById("songSections"), search: document.getElementById("searchInput"),
  filter: document.getElementById("filterRow"), controls: document.getElementById("controls"),
  toggle: document.getElementById("controlsToggle"), sort: document.getElementById("sortSelect"),
  roulette: document.getElementById("rouletteBtn"), modal: document.getElementById("rouletteModal"),
  result: document.getElementById("rouletteResult"), close: document.getElementById("closeModal"),
  toast: document.getElementById("toast")
};

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
if(els.toggle) els.toggle.onclick = () => els.controls.classList.toggle("collapsed");
if(els.search) els.search.oninput = e => { keyword=e.target.value; render(); };
if(els.sort) els.sort.onchange = e => { currentSort=e.target.value; render(); };
if(els.close) els.close.onclick = () => els.modal.classList.remove("show");

// ãƒ‡ãƒ¼ã‚¿å‡¦ç†ç³»
const escape = s => String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
const normalize = songs => songs.map(s => (s.memo&&s.memo.includes("å¼¾ãèªã‚Š")&&s.category!=="acoustic") ? {...s, category:"acoustic"} : s);

// æ›´æ–°æ—¥æ™‚
(function(){
  const d=new Date(document.lastModified), t=`${d.getFullYear()}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getDate().toString().padStart(2,'0')} ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
  ["lastUpdateTime","updatedDate"].forEach(id=>{ const e=document.getElementById(id); if(e)e.textContent=t; });
})();

// èª­ã¿è¾¼ã¿ï¼†æç”»
async function loadSongs() {
  try {
    const res = await fetch("songs.json", { cache:"no-store" }); if(!res.ok) throw new Error(res.status);
    allSongs = normalize(await res.json());
    buildFilters(); render();
  } catch(e) { els.sections.innerHTML = `<p style='text-align:center;margin-top:20px;color:red;'>SYSTEM ERROR: ${e.message}</p>`; }
}

function buildFilters() {
  if(!els.filter) return;
  const counts = allSongs.reduce((a,s)=>{ a.all++; a[s.category||"other"]=(a[s.category||"other"]||0)+1; return a; },{all:0});
  els.filter.innerHTML = ["all",...CATEGORY_ORDER].map(cat => 
    `<button class="filter-btn ${cat===filteredCategory?'active':''}" onclick="setCat('${cat}')">${CATEGORY_LABELS[cat]} (${counts[cat]||0})</button>`
  ).join("");
}
window.setCat = cat => { filteredCategory=cat; buildFilters(); render(); };

function render() {
  let list = allSongs.filter(s => (filteredCategory==="all" || (s.category||"other")===filteredCategory) && `${s.title} ${s.artist} ${s.memo}`.toLowerCase().includes(keyword.toLowerCase()));
  if(currentSort!=="default") list.sort((a,b) => (a[currentSort]||"").toString().localeCompare((b[currentSort]||"").toString(),"ja"));
  
  if(!list.length) { els.sections.innerHTML = "<p style='text-align:center;opacity:0.6;'>NO DATA FOUND</p>"; return; }
  
  const groups = list.reduce((g,s)=>{ (g[s.category||"other"]||=[]).push(s); return g; }, {});
  els.sections.innerHTML = CATEGORY_ORDER.filter(c=>groups[c]).map(cat => `
    <h2 style="color:var(--neon-blue); border-left:4px solid var(--neon-blue); padding-left:10px; margin:20px 0 10px;">${CATEGORY_LABELS[cat]}</h2>
    <div class="song-grid">${groups[cat].map((s,i)=>renderCard(s,i)).join("")}</div>
  `).join("");
}

function renderCard(s, i) {
  const key = s.memo ? (s.memo.match(/[-+]\d+/) || [""])[0] : "";
  const memoView = s.memo ? escape(s.memo.replace(key,"").trim().replace(/[\/ï½œ|ãƒ»:ï¼šã€ã€‚-]+$/,"")) : "";
  const copyText = escape(`${s.title} / ${s.artist||""}`);
  
  let pills = [];
  if(/ng/i.test(s.memo)) pills.push(`<span class="memo-pill memo-ng">NG</span>`);
  if(/ç·´ç¿’ä¸­/.test(s.memo)) pills.push(`<span class="memo-pill memo-training">TRAINING</span>`);
  if(key) pills.push(`<span class="memo-pill memo-key">KEY ${key}</span>`);

  return `<div class="song-card" style="--i:${i}">
    <div class="song-title">${escape(s.title)}</div>
    <div class="song-artist">${escape(s.artist||"")}</div>
    <div style="margin-top:8px; display:flex; gap:4px; flex-wrap:wrap;">${pills.join("")}</div>
    ${memoView ? `<div style="margin-top:8px; font-size:0.8rem; opacity:0.8;">${memoView}</div>` : ""}
    <div style="margin-top:12px; display:flex; gap:8px;">
      <button class="btn-copy" onclick="doCopy('${copyText}')" style="padding:4px 10px; border-radius:4px; cursor:pointer;">ğŸ“‹ COPY</button>
      ${s.url ? `<a href="${escape(s.url)}" target="_blank" style="color:var(--neon-pink); text-decoration:none; padding:4px 10px; border:1px solid var(--neon-pink); border-radius:4px;">â–¶ YOUTUBE</a>` : ""}
    </div>
  </div>`;
}

window.doCopy = t => navigator.clipboard.writeText(t).then(()=>{ els.toast.classList.add("show"); setTimeout(()=>els.toast.classList.remove("show"),2000); });

// ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ
if(els.roulette) els.roulette.onclick = () => {
  let list = allSongs.filter(s => (filteredCategory==="all" || (s.category||"other")===filteredCategory) && `${s.title} ${s.artist}`.toLowerCase().includes(keyword.toLowerCase()));
  if(!list.length) return alert("NO DATA FOR ROULETTE");
  els.modal.classList.add("show"); els.result.innerHTML = "SCANNING...";
  let c=0, interval=setInterval(()=>{
    els.result.textContent = list[Math.floor(Math.random()*list.length)].title;
    if(++c>20) { clearInterval(interval); const w=list[Math.floor(Math.random()*list.length)]; els.result.innerHTML=`<div style="font-size:0.8em;opacity:0.7">${w.artist}</div><div>${w.title}</div>`; }
  }, 70);
};

// 3D Tilt Effect
document.addEventListener('mousemove', e => {
  document.querySelectorAll('.song-card').forEach(c => {
    const r = c.getBoundingClientRect(); if(r.top>innerHeight||r.bottom<0)return;
    c.style.transform = `perspective(1000px) rotateX(${(e.clientY-(r.top+r.height/2))*-0.04}deg) rotateY(${(e.clientX-(r.left+r.width/2))*0.04}deg) scale(1.02)`;
  });
});
document.addEventListener('mouseleave', () => document.querySelectorAll('.song-card').forEach(c=>c.style.transform='perspective(1000px) rotateX(0) rotateY(0) scale(1)'));


// =========================================================
// JS: ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé›†ï¼ˆã‚°ãƒªãƒƒãƒå‰Šé™¤æ¸ˆã¿ï¼‰
// =========================================================

// 1. èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
const boot=document.getElementById("boot-screen"), logs=["INITIALIZING KERNEL...", "LOADING NEON_INTERFACE_V4...", "CONNECTING TO CYBER_SONG_DB...", "BYPASSING SECURITY...", "SYSTEM READY."];
window.onload = async () => {
  for(const log of logs) {
    const p=document.createElement("div"); p.textContent="> "+log; boot.appendChild(p);
    await new Promise(r=>setTimeout(r, 250+Math.random()*300));
  }
  boot.style.opacity=0; setTimeout(()=>{ boot.style.display="none"; loadSongs(); }, 500);
};

// 2. ãƒãƒˆãƒªãƒƒã‚¯ã‚¹èƒŒæ™¯
const mCanvas=document.getElementById("matrix-canvas"), mCtx=mCanvas.getContext("2d");
let mCols, mDrops;
function initMatrix(){
  mCanvas.width=innerWidth; mCanvas.height=innerHeight;
  mCols=Math.floor(innerWidth/20); mDrops=Array(mCols).fill(1);
}
function drawMatrix(){
  mCtx.fillStyle="rgba(0,0,0,0.05)"; mCtx.fillRect(0,0,innerWidth,innerHeight);
  mCtx.fillStyle="#0f0"; mCtx.font="15px monospace";
  for(let i=0; i<mDrops.length; i++){
    mCtx.fillText(String.fromCharCode(0x30A0+Math.random()*96), i*20, mDrops[i]*20);
    if(mDrops[i]*20>innerHeight && Math.random()>0.975) mDrops[i]=0;
    mDrops[i]++;
  }
  requestAnimationFrame(drawMatrix);
}
window.onresize=initMatrix; initMatrix(); drawMatrix();

// 3. ã‚«ãƒ¼ã‚½ãƒ«è»Œè·¡ï¼ˆç«èŠ±ï¼‰
const cCanvas=document.getElementById("cursor-canvas"), cCtx=cCanvas.getContext("2d");
let particles=[];
window.addEventListener("resize", ()=>{ cCanvas.width=innerWidth; cCanvas.height=innerHeight; });
window.dispatchEvent(new Event("resize"));
window.onmousemove = e => { for(let i=0;i<4;i++) particles.push({x:e.clientX, y:e.clientY, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4, life:1, color:`hsl(${Math.random()*60+180},100%,70%)`}); };
function animateParticles(){
  cCtx.clearRect(0,0,innerWidth,innerHeight);
  particles.forEach((p,i)=>{
    p.x+=p.vx; p.y+=p.vy; p.life-=0.02;
    cCtx.fillStyle=p.color; cCtx.globalAlpha=p.life; cCtx.beginPath(); cCtx.arc(p.x,p.y,Math.random()*3+1,0,Math.PI*2); cCtx.fill();
    if(p.life<=0) particles.splice(i,1);
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();

// 4. èƒŒæ™¯ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
const viz=document.getElementById("visualizer"); for(let i=0;i<40;i++){ const b=document.createElement("div"); b.className="viz-bar"; b.style.animationDuration=(0.4+Math.random()*0.6)+"s"; viz.appendChild(b); }

</script>
</body>
</html>